<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بنك الأسئلة الإلكتروني للرياضيات</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --math-color: #9b59b6;
            --business-color: #f39c12;
            --bank-color: #16a085;
            --teacher-color: #9b59b6;
            --warning-color: #f39c12;
            --info-color: #3498db;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
            padding-bottom: 50px;
            color: #333;
        }
        
        .header {
            background-color: rgba(44, 62, 80, 0.95);
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            z-index: 100;
        }
        
        .logo {
            color: white;
            font-weight: 700;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            color: var(--secondary-color);
            margin-left: 10px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            color: white;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--secondary-color);
            overflow: hidden;
            margin-left: 15px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .main-container {
            background-color: rgba(255, 255, 255, 0.92);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            margin-top: 30px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .sidebar {
            background-color: var(--primary-color);
            color: white;
            padding: 25px 15px;
            height: 100%;
        }
        
        .nav-link {
            color: var(--light-color);
            padding: 12px 20px;
            margin: 8px 0;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: var(--secondary-color);
            color: white;
            transform: translateX(5px);
        }
        
        .nav-link i {
            margin-left: 10px;
            font-size: 1.2rem;
        }
        
        .content {
            padding: 30px;
        }
        
        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100px;
            height: 2px;
            background-color: var(--accent-color);
        }
        
        .form-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #eee;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            padding: 10px 25px;
            font-weight: 600;
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
            padding: 10px 25px;
            font-weight: 600;
        }
        
        .btn-bank {
            background-color: var(--bank-color);
            border-color: var(--bank-color);
            padding: 10px 25px;
            font-weight: 600;
            color: white;
        }
        
        .btn-teacher {
            background-color: var(--teacher-color);
            border-color: var(--teacher-color);
            padding: 10px 25px;
            font-weight: 600;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .result-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .question-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .question-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .question-tag {
            background-color: var(--secondary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .question-tag.level {
            background-color: var(--accent-color);
        }
        
        .footer {
            background-color: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-top: 40px;
        }
        
        .action-btn {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .bloom-level {
            padding: 8px 15px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            margin: 5px;
            display: inline-block;
        }
        
        .unit-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--success-color);
        }
        
        .unit-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .badge-unit {
            background-color: var(--secondary-color);
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .stats-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin: 10px 0;
        }
        
        .stats-label {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .welcome-card {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .welcome-card h3 {
            margin-bottom: 10px;
        }
        
        .welcome-card p {
            opacity: 0.9;
        }
        
        .category-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .math-badge {
            background-color: var(--math-color);
            color: white;
        }
        
        .business-badge {
            background-color: var(--business-color);
            color: white;
        }
        
        .bank-badge {
            background-color: var(--bank-color);
            color: white;
        }
        
        .teacher-badge {
            background-color: var(--teacher-color);
            color: white;
        }
        
        .category-section {
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 10px;
        }
        
        .math-section {
            background-color: rgba(155, 89, 182, 0.1);
            border: 1px solid var(--math-color);
        }
        
        .business-section {
            background-color: rgba(243, 156, 18, 0.1);
            border: 1px solid var(--business-color);
        }
        
        .bank-section {
            background-color: rgba(22, 160, 133, 0.1);
            border: 1px solid var(--bank-color);
        }
        
        .teacher-section {
            background-color: rgba(155, 89, 182, 0.1);
            border: 1px solid var(--teacher-color);
        }
        
        .category-title {
            color: var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            border-bottom: 2px dashed;
        }
        
        .math-title {
            border-bottom-color: var(--math-color);
        }
        
        .business-title {
            border-bottom-color: var(--business-color);
        }
        
        .bank-title {
            border-bottom-color: var(--bank-color);
        }
        
        .teacher-title {
            border-bottom-color: var(--teacher-color);
        }
        
        .discrimination-slider, .guess-slider {
            margin: 15px 0;
        }
        
        .slider-value {
            font-weight: bold;
            color: var(--secondary-color);
            margin-right: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .coefficient-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .coefficient-info h5 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        /* أنماط جديدة للاختيار من متعدد */
        .options-container {
            margin-top: 15px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .option-item input[type="radio"] {
            margin-left: 10px;
        }
        
        .option-item input[type="text"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .add-option-btn {
            margin-top: 10px;
            background-color: var(--success-color);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .remove-option {
            color: var(--accent-color);
            margin-right: 10px;
            cursor: pointer;
            font-size: 18px;
        }
        
        .correct-answer {
            background-color: #e8f5e9;
            border-color: #2ecc71;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .question-actions button {
            font-size: 0.85rem;
            padding: 5px 10px;
        }
        
        .teacher-info-card {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .teacher-info-card i {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .bank-card {
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            height: 100%;
        }
        
        .bank-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .bank-card i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--bank-color);
        }
        
        .bank-config-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        
        .bank-preview {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .bank-question-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            background-color: white;
        }
        
        .student-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .student-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        .test-method-selector {
            display: none; /* إخفاء محدد طريقة الاختبار */
        }
        
        .results-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .export-test-card {
            background-color: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--success-color);
        }
        
        /* تحسينات جديدة */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .quick-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .quick-action-btn:hover {
            transform: scale(1.1);
            background-color: var(--primary-color);
        }
        
        .quick-actions-menu {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 15px;
            display: none;
            z-index: 999;
            min-width: 200px;
        }
        
        .quick-actions-menu.show {
            display: block;
        }
        
        .quick-action-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-action-item:hover {
            background-color: #f8f9fa;
        }
        
        .quick-action-item i {
            margin-left: 10px;
            color: var(--secondary-color);
        }
        
        .search-highlight {
            background-color: yellow;
            font-weight: bold;
        }
        
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .loading-spinner.show {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .dark-mode-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .dark-mode-toggle:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #f8f9fa;
        }
        
        body.dark-mode .main-container {
            background-color: rgba(30, 30, 45, 0.92);
        }
        
        body.dark-mode .form-card {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .question-card {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .stats-card {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .unit-card {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .coefficient-info {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .bank-preview {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .quick-actions-menu {
            background-color: #2c2c3e;
            color: #f8f9fa;
        }
        
        body.dark-mode .quick-action-item:hover {
            background-color: #3c3c4e;
        }
        
        .tooltip-custom {
            position: relative;
            display: inline-block;
        }
        
        .tooltip-custom .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--primary-color);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
        }
        
        .tooltip-custom:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .question-type-badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
        }
        
        .multiple-choice-badge {
            background-color: var(--info-color);
            color: white;
        }
        
        .true-false-badge {
            background-color: var(--warning-color);
            color: white;
        }
        
        .short-answer-badge {
            background-color: var(--success-color);
            color: white;
        }
        
        .essay-badge {
            background-color: var(--accent-color);
            color: white;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .filter-tag {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
            border-radius: 15px;
            padding: 5px 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }
        
        .filter-tag .remove-tag {
            margin-right: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .filter-tag .remove-tag:hover {
            color: var(--accent-color);
        }
        
        /* تحسينات واجهة اختيار الأسئلة */
        .question-selector {
            margin-bottom: 20px;
        }
        
        .question-selector .form-check {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .question-selector .form-check:hover {
            background-color: #f0f0f0;
        }
        
        .question-selector .form-check-input {
            margin-left: 10px;
        }
        
        .question-selector .form-check-label {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        
        .question-meta {
            font-size: 0.8rem;
            color: #666;
        }
        
        .selected-questions-count {
            background-color: var(--secondary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* تحسينات نظام التصحيح الإلكتروني */
        .result-summary {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--success-color);
        }
        
        .result-summary h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .result-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        
        .result-stat {
            text-align: center;
        }
        
        .result-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary-color);
        }
        
        .result-stat-label {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .question-result {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: white;
            border: 1px solid #eee;
        }
        
        .question-result.correct {
            border-left: 4px solid var(--success-color);
        }
        
        .question-result.incorrect {
            border-left: 4px solid var(--accent-color);
        }
        
        .question-result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .question-result-status {
            font-weight: 600;
        }
        
        .question-result-status.correct {
            color: var(--success-color);
        }
        
        .question-result-status.incorrect {
            color: var(--accent-color);
        }
        
        .question-result-answer {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .question-result-correct-answer {
            margin-top: 10px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 5px;
        }
        
        .question-result-explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 5px;
            font-style: italic;
        }
        
        /* تحسينات للطريقة الإلكترونية فقط */
        .electronic-test-method {
            background-color: rgba(52, 152, 219, 0.1);
            border: 2px solid var(--secondary-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .electronic-test-method h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .electronic-test-method p {
            margin-bottom: 15px;
        }
        
        .electronic-test-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .electronic-test-option {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            text-align: center;
        }
        
        .electronic-test-option i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .electronic-test-option h5 {
            margin-bottom: 10px;
        }
        
        .electronic-test-option button {
            margin-top: 10px;
        }
        
        /* تحسينات خانة الإجابة الصحيحة */
        .correct-answer-section {
            background-color: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .correct-answer-section h5 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .correct-answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .correct-answer-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            transition: all 0.2s;
        }
        
        .correct-answer-option:hover {
            background-color: #f0f0f0;
        }
        
        .correct-answer-option input[type="radio"] {
            margin-left: 10px;
        }
        
        .correct-answer-option.correct {
            background-color: #e8f5e9;
            border-color: #2ecc71;
        }
        
        .correct-answer-option.correct input[type="radio"] {
            accent-color: #2ecc71;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                margin-bottom: 30px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .user-profile {
                margin-top: 15px;
                justify-content: center;
            }
            
            .test-method-selector {
                flex-direction: column;
            }
            
            .quick-action-btn {
                bottom: 15px;
                right: 15px;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .quick-actions-menu {
                bottom: 75px;
                right: 15px;
                min-width: 150px;
            }
            
            .electronic-test-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- شريط العنوان -->
    <header class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="logo">
                        <i class="fas fa-calculator"></i>
                        بنك الأسئلة الإلكتروني للرياضيات
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="user-profile">
                        <div class="user-avatar">
                            <img src="https://via.placeholder.com/50" alt="صورة المستخدم" id="user-avatar">
                        </div>
                        <div class="user-info">
                            <span class="user-name" id="user-name">الدكتور ايمن قهوجي</span>
                            <span class="user-role">خبير القياس والإحصاء اليونسكو</span>
                        </div>
                        <div class="logout-btn" style="margin-right: 15px;">
                            <button class="btn btn-sm btn-outline-light" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>
    
    <div class="container main-container">
        <div class="row">
            <!-- القائمة الجانبية -->
            <div class="col-md-3">
                <div class="sidebar">
                    <div class="text-center mb-4">
                        <div class="user-avatar" style="width: 80px; height: 80px; margin: 0 auto;">
                            <img src="https://via.placeholder.com/80" alt="صورة المستخدم" id="sidebar-avatar">
                        </div>
                        <h5 class="mt-2" id="sidebar-name">الدكتور ايمن قهوجي</h5>
                        <p class="text-light">خبير القياس والإحصاء اليونسكو</p>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-tab="dashboard">
                                <i class="fas fa-home"></i>
                                الصفحة الرئيسية
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="create-bank">
                                <i class="fas fa-database"></i>
                                إنشاء بنك أسئلة
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="manage-banks">
                                <i class="fas fa-book"></i>
                                إدارة البنوك
                                <span class="notification-badge">5</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="create-test">
                                <i class="fas fa-file-alt"></i>
                                إنشاء اختبار
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="test-results">
                                <i class="fas fa-chart-line"></i>
                                نتائج الاختبارات
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="manage-students">
                                <i class="fas fa-users"></i>
                                إدارة الطلاب
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="manage-units">
                                <i class="fas fa-cubes"></i>
                                إدارة الوحدات
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="statistics">
                                <i class="fas fa-chart-bar"></i>
                                الإحصائيات
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                تسجيل الخروج
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- المحتوى الرئيسي -->
            <div class="col-md-9">
                <div class="content">
                    <!-- لوحة التحكم -->
                    <div id="dashboard" class="tab-content active">
                        <div class="welcome-card">
                            <h3>مرحباً بك في بنك الأسئلة الإلكتروني</h3>
                            <p>نظام متكامل لإدارة وتصنيف أسئلة الرياضيات حسب تصنيف بلوم المعرفي</p>
                        </div>
                        
                        <h2 class="section-title">لوحة التحكم الرئيسية</h2>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-database fa-3x text-primary"></i>
                                    <div class="stats-number" id="banks-count">5</div>
                                    <div class="stats-label">بنوك الأسئلة</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-question-circle fa-3x text-success"></i>
                                    <div class="stats-number" id="questions-count">127</div>
                                    <div class="stats-label">الأسئلة في البنك</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-brain fa-3x text-danger"></i>
                                    <div class="stats-number" id="bloom-levels">6</div>
                                    <div class="stats-label">مستويات بلوم المعرفية</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-users fa-3x text-warning"></i>
                                    <div class="stats-number" id="students-count">35</div>
                                    <div class="stats-label">الطلاب المسجلين</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="form-card">
                                    <h4><i class="fas fa-lightbulb me-2"></i>دليل سريع</h4>
                                    <ul>
                                        <li>استخدم قسم "إنشاء بنك أسئلة" لإنشاء بنك جديد للأسئلة</li>
                                        <li>أضف أسئلة جديدة وربطها بالوحدة المناسبة ومستوى بلوم المعرفي</li>
                                        <li>استخدم قسم "إدارة البنوك" لتنظيم بنوك الأسئلة الخاصة بك</li>
                                        <li>استخرج اختبارات عشوائية حسب الوحدة ومستوى الصعوبة</li>
                                        <li>يمكنك تعديل أو حذف أي سؤال من قسم "إدارة البنوك"</li>
                                        <li>تابع إحصائيات البنك من قسم الإحصائيات</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="mt-5">بنوك الأسئلة المتاحة</h4>
                        
                        <!-- قسم الرياضيات المتقدم -->
                        <div class="category-section math-section">
                            <h4 class="category-title math-title">
                                <i class="fas fa-square-root-variable me-2"></i>
                                الرياضيات المتقدم
                                <span class="category-badge math-badge">3 بنوك</span>
                            </h4>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="unit-card">
                                        <div class="unit-header">
                                            <h5>بنك الاقترانات</h5>
                                            <span class="badge bg-success">54 سؤال</span>
                                        </div>
                                        <p class="text-muted">أسئلة متنوعة حول الاقترانات بأنواعها وخصائصها</p>
                                        <div class="action-btn">
                                            <button class="btn btn-sm btn-primary">فتح البنك</button>
                                            <button class="btn btn-sm btn-secondary">تصدير</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="unit-card">
                                        <div class="unit-header">
                                            <h5>بنك التفاضل</h5>
                                            <span class="badge bg-success">38 سؤال</span>
                                        </div>
                                        <p class="text-muted">قواعد التفاضل وتطبيقاتها بأنواعها</p>
                                        <div class="action-btn">
                                            <button class="btn btn-sm btn-primary">فتح البنك</button>
                                            <button class="btn btn-sm btn-secondary">تصدير</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="unit-card">
                                        <div class="unit-header">
                                            <h5>بنك التكامل</h5>
                                            <span class="badge bg-success">42 سؤال</span>
                                        </div>
                                        <p class="text-muted">طرق التكامل المختلفة وتطبيقاتها</p>
                                        <div class="action-btn">
                                            <button class="btn btn-sm btn-primary">فتح البنك</button>
                                            <button class="btn btn-sm btn-secondary">تصدير</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- قسم رياضيات الأعمال -->
                        <div class="category-section business-section mt-4">
                            <h4 class="category-title business-title">
                                <i class="fas fa-chart-line me-2"></i>
                                رياضيات الأعمال
                                <span class="category-badge business-badge">2 بنوك</span>
                            </h4>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="unit-card">
                                        <div class="unit-header">
                                            <h5>بنك المصفوفات</h5>
                                            <span class="badge bg-success">27 سؤال</span>
                                        </div>
                                        <p class="text-muted">عمليات المصفوفات وتطبيقاتها في الأعمال</p>
                                        <div class="action-btn">
                                            <button class="btn btn-sm btn-primary">فتح البنك</button>
                                            <button class="btn btn-sm btn-secondary">تصدير</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="unit-card">
                                        <div class="unit-header">
                                            <h5>بنك البرمجة الخطية</h5>
                                            <span class="badge bg-success">33 سؤال</span>
                                        </div>
                                        <p class="text-muted">نماذج البرمجة الخطية وتطبيقاتها</p>
                                        <div class="action-btn">
                                            <button class="btn btn-sm btn-primary">فتح البنك</button>
                                            <button class="btn btn-sm btn-secondary">تصدير</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إنشاء بنك أسئلة -->
                    <div id="create-bank" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-database me-2"></i>إنشاء بنك أسئلة جديد</h2>
                        
                        <div class="teacher-info-card">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <h3>بنك الأسئلة للمعلمين</h3>
                            <p>يمكنك هنا إنشاء بنك أسئلة جديد وتخصيصه حسب احتياجاتك التعليمية</p>
                        </div>
                        
                        <div class="form-card">
                            <h4><i class="fas fa-cog me-2"></i>إعدادات بنك الأسئلة</h4>
                            <form id="bankForm">
                                <div class="bank-config-item">
                                    <label class="form-label">اسم بنك الأسئلة</label>
                                    <input type="text" class="form-control" id="bank-name" placeholder="أدخل اسم بنك الأسئلة" required>
                                </div>
                                
                                <div class="bank-config-item">
                                    <label class="form-label">وصف بنك الأسئلة</label>
                                    <textarea class="form-control" id="bank-description" rows="2" placeholder="أدخل وصفاً لبنك الأسئلة"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="bank-config-item">
                                            <label class="form-label">القسم الدراسي</label>
                                            <select class="form-select" id="bank-category" required>
                                                <option value="">اختر القسم الدراسي</option>
                                                <option value="math">الرياضيات المتقدم</option>
                                                <option value="business">رياضيات الأعمال</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="bank-config-item">
                                            <label class="form-label">الوحدة الدراسية</label>
                                            <select class="form-select" id="bank-unit" required>
                                                <option value="">اختر الوحدة الدراسية</option>
                                                <!-- وحدات الرياضيات المتقدم -->
                                                <option value="functions">الاقترانات</option>
                                                <option value="trigonometry">المعادلات المثلثية</option>
                                                <option value="differentiation">التفاضل</option>
                                                <option value="complex">الأعداد المركبة</option>
                                                <option value="integration">التكامل</option>
                                                <option value="vectors">المتجهات</option>
                                                <option value="statistics">الإحصاء</option>
                                                <!-- وحدات رياضيات الأعمال -->
                                                <option value="matrices">المصفوفات</option>
                                                <option value="decision">اتخاذ القرار</option>
                                                <option value="linear">البرمجة الخطية</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bank-config-item">
                                    <label class="form-label">مستوى الصعوبة العام</label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="difficulty" id="easy" value="easy">
                                            <label class="form-check-label" for="easy">سهل</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="difficulty" id="medium" value="medium" checked>
                                            <label class="form-check-label" for="medium">متوسط</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="difficulty" id="hard" value="hard">
                                            <label class="form-check-label" for="hard">صعب</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bank-config-item">
                                    <label class="form-label">الفئة المستهدفة</label>
                                    <input type="text" class="form-control" id="target-audience" placeholder="مثال: الصف الأول الثانوي - علمي">
                                </div>
                                
                                <div class="action-btn">
                                    <button type="submit" class="btn btn-teacher">
                                        <i class="fas fa-plus-circle me-2"></i>إنشاء البنك
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="resetBankForm()">
                                        <i class="fas fa-times me-2"></i>إلغاء
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="form-card mt-4" id="bank-success" style="display: none;">
                            <div class="alert alert-success text-center">
                                <i class="fas fa-check-circle fa-3x mb-3"></i>
                                <h4>تم إنشاء بنك الأسئلة بنجاح!</h4>
                                <p>يمكنك الآن البدء في إضافة الأسئلة إلى البنك من خلال قسم "إدارة البنوك"</p>
                            </div>
                            
                            <div class="action-btn">
                                <button class="btn btn-teacher" onclick="goToManageBanks()">
                                    <i class="fas fa-book me-2"></i>الذهاب إلى إدارة البنوك
                                </button>
                                <button class="btn btn-primary" onclick="createAnotherBank()">
                                    <i class="fas fa-plus me-2"></i>إنشاء بنك آخر
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إدارة البنوك -->
                    <div id="manage-banks" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-book me-2"></i>إدارة بنوك الأسئلة</h2>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="ابحث عن بنك أسئلة..." id="bank-search">
                                    <button class="btn btn-primary" type="button" onclick="searchBanks()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 text-left">
                                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addQuestionModal">
                                    <i class="fas fa-plus-circle me-2"></i>إضافة سؤال جديد
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-card">
                            <h4><i class="fas fa-filter me-2"></i>تصفية البنوك</h4>
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="form-select" id="filter-category" onchange="filterBanks()">
                                        <option value="">جميع الأقسام</option>
                                        <option value="math">الرياضيات المتقدم</option>
                                        <option value="business">رياضيات الأعمال</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="filter-unit" onchange="filterBanks()">
                                        <option value="">جميع الوحدات</option>
                                        <option value="functions">الاقترانات</option>
                                        <option value="differentiation">التفاضل</option>
                                        <option value="integration">التكامل</option>
                                        <option value="matrices">المصفوفات</option>
                                        <option value="linear">البرمجة الخطية</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="filter-difficulty" onchange="filterBanks()">
                                        <option value="">جميع المستويات</option>
                                        <option value="easy">سهل</option>
                                        <option value="medium">متوسط</option>
                                        <option value="hard">صعب</option>
                                    </select>
                                </div>
                            </div>
                            <div class="filter-tags" id="filter-tags"></div>
                        </div>
                        
                        <div id="banks-container">
                            <!-- سيتم ملء هذا القسم ديناميكياً باستخدام JavaScript -->
                        </div>
                    </div>
                    
                    <!-- إنشاء اختبار -->
                    <div id="create-test" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-file-alt me-2"></i>إنشاء اختبار</h2>
                        
                        <div class="form-card">
                            <h4><i class="fas fa-cog me-2"></i>إعدادات الاختبار</h4>
                            <form id="testForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">عنوان الاختبار</label>
                                            <input type="text" class="form-control" id="test-title" placeholder="أدخل عنوان الاختبار" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">مدة الاختبار (دقيقة)</label>
                                            <input type="number" class="form-control" id="test-duration" min="5" value="60" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">وصف الاختبار</label>
                                    <textarea class="form-control" id="test-description" rows="2" placeholder="أدخل وصفاً للاختبار"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">القسم الدراسي</label>
                                            <select class="form-select" id="test-category" required>
                                                <option value="">اختر القسم الدراسي</option>
                                                <option value="math">الرياضيات المتقدم</option>
                                                <option value="business">رياضيات الأعمال</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">الوحدة الدراسية</label>
                                            <select class="form-select" id="test-unit" required>
                                                <option value="">اختر الوحدة الدراسية</option>
                                                <option value="functions">الاقترانات</option>
                                                <option value="differentiation">التفاضل</option>
                                                <option value="integration">التكامل</option>
                                                <option value="matrices">المصفوفات</option>
                                                <option value="linear">البرمجة الخطية</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">عدد الأسئلة</label>
                                            <input type="number" class="form-control" id="test-questions-count" min="1" max="50" value="10" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">توزيع مستويات الصعوبة</label>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>سهل (%)</label>
                                            <input type="number" class="form-control" id="easy-percent" min="0" max="100" value="20">
                                        </div>
                                        <div class="col-md-4">
                                            <label>متوسط (%)</label>
                                            <input type="number" class="form-control" id="medium-percent" min="0" max="100" value="60">
                                        </div>
                                        <div class="col-md-4">
                                            <label>صعب (%)</label>
                                            <input type="number" class="form-control" id="hard-percent" min="0" max="100" value="20">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="action-btn">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-cogs me-2"></i>إنشاء الاختبار
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="resetTestForm()">
                                        <i class="fas fa-times me-2"></i>إلغاء
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="form-card mt-4" id="test-preview" style="display: none;">
                            <h4><i class="fas fa-eye me-2"></i>معاينة الاختبار</h4>
                            
                            <!-- عرض الطريقة الإلكترونية فقط -->
                            <div class="electronic-test-method">
                                <h4><i class="fas fa-laptop me-2"></i>طريقة إلكترونية</h4>
                                <p>سيتم إتاحة الاختبار للطلاب عبر المنصة الإلكترونية مع نظام تصحيح فوري وإظهار النتائج بعد الانتهاء.</p>
                                
                                <div class="electronic-test-options">
                                    <div class="electronic-test-option">
                                        <i class="fas fa-users"></i>
                                        <h5>للطلاب</h5>
                                        <p>سيتمكن الطلاب من حل الاختبار إلكترونياً ورؤية النتائج فوراً.</p>
                                        <button class="btn btn-primary" onclick="exportTestToStudents()">
                                            <i class="fas fa-share me-1"></i>تصدير للطلاب
                                        </button>
                                    </div>
                                    <div class="electronic-test-option">
                                        <i class="fas fa-file-pdf"></i>
                                        <h5>نسخة PDF</h5>
                                        <p>يمكنك تحميل نسخة PDF من الاختبار للمراجعة.</p>
                                        <button class="btn btn-secondary" onclick="downloadTest()">
                                            <i class="fas fa-download me-1"></i>تحميل PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="test-questions-container">
                                <!-- سيتم ملء هذا القسم ديناميكياً باستخدام JavaScript -->
                            </div>
                            
                            <div class="action-btn">
                                <button class="btn btn-success" onclick="downloadTest()">
                                    <i class="fas fa-download me-2"></i>تحميل الاختبار
                                </button>
                                <button class="btn btn-primary" onclick="printTest()">
                                    <i class="fas fa-print me-2"></i>طباعة الاختبار
                                </button>
                                <button class="btn btn-teacher" id="export-test-btn" onclick="exportTestToStudents()">
                                    <i class="fas fa-share me-2"></i>تصدير للطلاب
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- نتائج الاختبارات -->
                    <div id="test-results" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-chart-line me-2"></i>نتائج الاختبارات</h2>
                        
                        <div class="form-card">
                            <h4><i class="fas fa-filter me-2"></i>تصفية النتائج</h4>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">اختر الاختبار</label>
                                        <select class="form-select" id="result-test">
                                            <option value="all">جميع الاختبارات</option>
                                            <option value="test1">اختبار الاقترانات - 2023</option>
                                            <option value="test2">اختبار التفاضل - 2023</option>
                                            <option value="test3">اختبار التكامل - 2023</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">الفترة الزمنية</label>
                                        <select class="form-select" id="result-period">
                                            <option value="all">كل الفترات</option>
                                            <option value="week">آخر أسبوع</option>
                                            <option value="month">آخر شهر</option>
                                            <option value="year">آخر سنة</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">ترتيب النتائج</label>
                                        <select class="form-select" id="result-order">
                                            <option value="date">حسب التاريخ</option>
                                            <option value="score">حسب الدرجة</option>
                                            <option value="name">حسب الاسم</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card mt-4">
                            <h4><i class="fas fa-table me-2"></i>نتائج الطلاب</h4>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>اسم الطالب</th>
                                            <th>الشعبة</th>
                                            <th>الاختبار</th>
                                            <th>التاريخ</th>
                                            <th>الدرجة</th>
                                            <th>النسبة</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="results-table-body">
                                        <!-- سيتم ملء هذا القسم ديناميكياً باستخدام JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="results-actions">
                                <button class="btn btn-primary" onclick="printResults()">
                                    <i class="fas fa-print me-2"></i>طباعة النتائج
                                </button>
                                <button class="btn btn-success" onclick="exportResults()">
                                    <i class="fas fa-file-export me-2"></i>تصدير النتائج
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-card mt-4">
                            <h4><i class="fas fa-chart-bar me-2"></i>تحليل النتائج</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="scoreDistributionChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="questionDifficultyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إدارة الطلاب -->
                    <div id="manage-students" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-users me-2"></i>إدارة الطلاب</h2>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                                    <i class="fas fa-plus-circle me-2"></i>إضافة طالب جديد
                                </button>
                                <button class="btn btn-success ms-2" onclick="importStudents()">
                                    <i class="fas fa-file-import me-2"></i>استيراد قائمة
                                </button>
                            </div>
                            <div class="col-md-6 text-left">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="ابحث عن طالب..." id="student-search">
                                    <button class="btn btn-primary" type="button" onclick="searchStudents()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card">
                            <h4><i class="fas fa-filter me-2"></i>تصفية الطلاب</h4>
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="form-select" id="filter-class" onchange="filterStudents()">
                                        <option value="">جميع الشعب</option>
                                        <option value="class1">شعبة 1</option>
                                        <option value="class2">شعبة 2</option>
                                        <option value="class3">شعبة 3</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="filter-status" onchange="filterStudents()">
                                        <option value="">جميع الحالات</option>
                                        <option value="active">نشط</option>
                                        <option value="inactive">غير نشط</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-secondary w-100" onclick="resetStudentFilters()">
                                        <i class="fas fa-times me-2"></i>إعادة التعيين
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card mt-4">
                            <h4><i class="fas fa-user-graduate me-2"></i>قائمة الطلاب</h4>
                            <div class="student-list" id="students-list">
                                <!-- سيتم ملء هذا القسم ديناميكياً باستخدام JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- إدارة الوحدات -->
                    <div id="manage-units" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-cubes me-2"></i>إدارة الوحدات</h2>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUnitModal">
                                    <i class="fas fa-plus-circle me-2"></i>إضافة وحدة جديدة
                                </button>
                            </div>
                            <div class="col-md-6 text-left">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="ابحث عن وحدة..." id="unit-search">
                                    <button class="btn btn-primary" type="button" onclick="searchUnits()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row" id="units-container">
                            <!-- سيتم ملء هذا القسم ديناميكياً باستخدام JavaScript -->
                        </div>
                    </div>
                    
                    <!-- الإحصائيات -->
                    <div id="statistics" class="tab-content">
                        <h2 class="section-title"><i class="fas fa-chart-bar me-2"></i>الإحصائيات</h2>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-database fa-2x text-primary"></i>
                                    <div class="stats-number">8</div>
                                    <div class="stats-label">بنوك الأسئلة</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-question-circle fa-2x text-success"></i>
                                    <div class="stats-number">243</div>
                                    <div class="stats-label">الأسئلة الكلية</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-file-alt fa-2x text-info"></i>
                                    <div class="stats-number">15</div>
                                    <div class="stats-label">الاختبارات المنشأة</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-card">
                                    <i class="fas fa-users fa-2x text-warning"></i>
                                    <div class="stats-number">87</div>
                                    <div class="stats-label">الطلاب المستفيدين</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card mt-4">
                            <h4><i class="fas fa-chart-pie me-2"></i>توزيع الأسئلة حسب المستوى</h4>
                            <div class="chart-container">
                                <canvas id="questionLevelChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="form-card">
                                    <h4><i class="fas fa-book me-2"></i>توزيع الأسئلة حسب الوحدة</h4>
                                    <div class="chart-container">
                                        <canvas id="questionUnitChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-card">
                                    <h4><i class="fas fa-brain me-2"></i>توزيع الأسئلة حسب تصنيف بلوم</h4>
                                    <div class="chart-container">
                                        <canvas id="bloomDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card mt-4">
                            <h4><i class="fas fa-list-alt me-2"></i>أحدث الأسئلة المضافة</h4>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>نص السؤال</th>
                                            <th>الوحدة</th>
                                            <th>المستوى</th>
                                            <th>التاريخ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>ما هو مشتق الدالة f(x) = x²؟</td>
                                            <td>التفاضل</td>
                                            <td><span class="badge bg-success">سهل</span></td>
                                            <td>2023-10-18</td>
                                        </tr>
                                        <tr>
                                            <td>احسب تكامل الدالة f(x) = 3x² + 2x</td>
                                            <td>التكامل</td>
                                            <td><span class="badge bg-warning">متوسط</span></td>
                                            <td>2023-10-17</td>
                                        </tr>
                                        <tr>
                                            <td>حل نظام المعادلات باستخدام المصفوفات</td>
                                            <td>المصفوفات</td>
                                            <td><span class="badge bg-danger">صعب</span></td>
                                            <td>2023-10-16</td>
                                        </tr>
                                        <tr>
                                            <td>ما هي خصائص الاقترانات الأسية؟</td>
                                            <td>الاقترانات</td>
                                            <td><span class="badge bg-success">سهل</span></td>
                                            <td>2023-10-15</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal لإضافة سؤال -->
    <div class="modal fade" id="addQuestionModal" tabindex="-1" aria-labelledby="addQuestionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addQuestionModalLabel">إضافة سؤال جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="questionForm">
                        <div class="mb-3">
                            <label class="form-label">نص السؤال</label>
                            <textarea class="form-control" id="question-text" rows="3" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">بنك الأسئلة</label>
                                    <select class="form-select" id="question-bank" required>
                                        <option value="">اختر بنك الأسئلة</option>
                                        <option value="1">بنك الاقترانات</option>
                                        <option value="2">بنك التفاضل</option>
                                        <option value="3">بنك التكامل</option>
                                        <option value="4">بنك المصفوفات</option>
                                        <option value="5">بنك البرمجة الخطية</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">مستوى الصعوبة</label>
                                    <select class="form-select" id="question-difficulty" required>
                                        <option value="easy">سهل</option>
                                        <option value="medium">متوسط</option>
                                        <option value="hard">صعب</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">تصنيف بلوم المعرفي</label>
                            <select class="form-select" id="question-bloom" required>
                                <option value="knowledge">التذكر</option>
                                <option value="comprehension">الفهم</option>
                                <option value="application">التطبيق</option>
                                <option value="analysis">التحليل</option>
                                <option value="synthesis">التركيب</option>
                                <option value="evaluation">التقويم</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الدرجة</label>
                            <input type="number" class="form-control" id="question-points" min="1" max="10" value="5" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">نوع السؤال</label>
                            <select class="form-select" id="question-type" required onchange="toggleQuestionOptions()">
                                <option value="multiple">اختيار من متعدد</option>
                                <option value="truefalse">صح أم خطأ</option>
                                <option value="shortanswer">إجابة قصيرة</option>
                                <option value="essay">مقالي</option>
                            </select>
                        </div>
                        
                        <div id="options-container" class="mb-3">
                            <label class="form-label">خيارات الإجابة</label>
                            <div class="option-item">
                                <span class="remove-option" onclick="removeOption(this)">×</span>
                                <input type="radio" name="correct-answer" required>
                                <input type="text" class="form-control" placeholder="نص الخيار" required>
                            </div>
                            <div class="option-item">
                                <span class="remove-option" onclick="removeOption(this)">×</span>
                                <input type="radio" name="correct-answer">
                                <input type="text" class="form-control" placeholder="نص الخيار" required>
                            </div>
                            <button type="button" class="btn btn-sm btn-success add-option-btn" onclick="addOption()">
                                <i class="fas fa-plus me-1"></i>إضافة خيار
                            </button>
                        </div>
                        
                        <!-- قسم تحديد الإجابة الصحيحة -->
                        <div id="correct-answer-section" class="correct-answer-section mb-3">
                            <h5>تحديد الإجابة الصحيحة</h5>
                            <p>اختر الإجابة الصحيحة من بين الخيارات المتاحة:</p>
                            <div class="correct-answer-options" id="correct-answer-options">
                                <!-- سيتم ملء هذا القسم ديناميكياً -->
                            </div>
                        </div>
                        
                        <div id="short-answer-container" class="mb-3" style="display: none;">
                            <label class="form-label">الإجابة النموذجية</label>
                            <textarea class="form-control" id="short-answer" rows="2"></textarea>
                        </div>
                        
                        <div id="essay-container" class="mb-3" style="display: none;">
                            <label class="form-label">نموذج الإجابة</label>
                            <textarea class="form-control" id="essay-answer" rows="4"></textarea>
                            <div class="mt-2">
                                <label class="form-label">معايير التقييم</label>
                                <textarea class="form-control" id="essay-criteria" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="saveQuestion()">حفظ السؤال</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal لإضافة وحدة -->
    <div class="modal fade" id="addUnitModal" tabindex="-1" aria-labelledby="addUnitModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUnitModalLabel">إضافة وحدة جديدة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="unitForm">
                        <div class="mb-3">
                            <label class="form-label">اسم الوحدة</label>
                            <input type="text" class="form-control" id="unit-name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">وصف الوحدة</label>
                            <textarea class="form-control" id="unit-description" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">القسم الدراسي</label>
                            <select class="form-select" id="unit-category" required>
                                <option value="math">الرياضيات المتقدم</option>
                                <option value="business">رياضيات الأعمال</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="saveUnit()">حفظ الوحدة</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal لإضافة طالب -->
    <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addStudentModalLabel">إضافة طالب جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="studentForm">
                        <div class="mb-3">
                            <label class="form-label">اسم الطالب</label>
                            <input type="text" class="form-control" id="student-name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">رقم الهوية</label>
                            <input type="text" class="form-control" id="student-id" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الشعبة</label>
                            <select class="form-select" id="student-class" required>
                                <option value="">اختر الشعبة</option>
                                <option value="class1">شعبة 1</option>
                                <option value="class2">شعبة 2</option>
                                <option value="class3">شعبة 3</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">البريد الإلكتروني</label>
                            <input type="email" class="form-control" id="student-email">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="saveStudent()">حفظ الطالب</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal لاختيار الأسئلة من البنوك -->
    <div class="modal fade" id="selectQuestionsModal" tabindex="-1" aria-labelledby="selectQuestionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="selectQuestionsModalLabel">اختيار الأسئلة من البنوك</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="ابحث عن سؤال..." id="question-search">
                                <button class="btn btn-primary" type="button" onclick="searchQuestions()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="selected-questions-count">الأسئلة المحددة: 0</span>
                                <button class="btn btn-sm btn-outline-danger" onclick="clearSelectedQuestions()">
                                    <i class="fas fa-times me-1"></i>مسح التحديد
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-selector" id="question-selector">
                        <!-- سيتم ملء هذا القسم ديناميكياً باستخدام JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="addSelectedQuestions()">إضافة الأسئلة المحددة</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- زر الإجراءات السريعة -->
    <button class="quick-action-btn" onclick="toggleQuickActions()">
        <i class="fas fa-plus"></i>
    </button>
    
    <!-- قائمة الإجراءات السريعة -->
    <div class="quick-actions-menu" id="quick-actions-menu">
        <div class="quick-action-item" onclick="quickAddQuestion()">
            <i class="fas fa-question-circle"></i>
            <span>إضافة سؤال سريع</span>
        </div>
        <div class="quick-action-item" onclick="quickCreateTest()">
            <i class="fas fa-file-alt"></i>
            <span>إنشاء اختبار سريع</span>
        </div>
        <div class="quick-action-item" onclick="quickAddStudent()">
            <i class="fas fa-user-plus"></i>
            <span>إضافة طالب سريع</span>
        </div>
        <div class="quick-action-item" onclick="exportData()">
            <i class="fas fa-file-export"></i>
            <span>تصدير البيانات</span>
        </div>
    </div>
    
    <!-- شاشة التحميل -->
    <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
    </div>
    
    <footer class="footer">
        <div class="container">
            <p>جميع الحقوق محفوظة &copy; 2023 - الدكتور ايمن القهوجي</p>
            <p>بنك الأسئلة الإلكتروني للرياضيات - نظام متكامل لإدارة وتوليد أسئلة الرياضيات</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // بيانات بنوك الأسئلة
        let questionBanks = [];
        let questions = [];
        let tests = [];
        let units = [];
        let students = [];
        let testResults = [];
        let selectedTestMethod = '';
        let darkMode = false;
        let selectedQuestions = [];
        
        // تطبيق بيانات المستخدم على الواجهة
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين الاسم
            document.getElementById('user-name').textContent = "الدكتور ايمن قهوجي";
            document.getElementById('sidebar-name').textContent = "الدكتور ايمن قهوجي";
            
            // تعيين الدور/الوظيفة
            document.querySelector('.user-role').textContent = "خبير القياس والإحصاء اليونسكو";
            
            // تحميل البيانات من localStorage إذا كانت موجودة
            loadFromLocalStorage();
            
            // تهيئة الرسوم البيانية
            initCharts();
            
            // إعداد مستمعي الأحداث
            setupEventListeners();
            
            // عرض بنوك الأسئلة في قسم إدارة البنوك
            displayQuestionBanks();
            
            // عرض الطلاب في قسم إدارة الطلاب
            displayStudents();
            
            // عرض نتائج الاختبارات
            displayTestResults();
            
            // عرض الوحدات في قسم إدارة الوحدات
            displayUnits();
        });
        
        // تحميل البيانات من localStorage
        function loadFromLocalStorage() {
            const savedBanks = localStorage.getItem('questionBanks');
            const savedQuestions = localStorage.getItem('questions');
            const savedTests = localStorage.getItem('tests');
            const savedUnits = localStorage.getItem('units');
            const savedStudents = localStorage.getItem('students');
            const savedResults = localStorage.getItem('testResults');
            const savedDarkMode = localStorage.getItem('darkMode');
            
            if (savedBanks) {
                questionBanks = JSON.parse(savedBanks);
                document.getElementById('banks-count').textContent = questionBanks.length;
            }
            
            if (savedQuestions) {
                questions = JSON.parse(savedQuestions);
                document.getElementById('questions-count').textContent = questions.length;
            }
            
            if (savedTests) {
                tests = JSON.parse(savedTests);
            }
            
            if (savedUnits) {
                units = JSON.parse(savedUnits);
            } else {
                // بيانات وحدات افتراضية
                units = [
                    { id: 1, name: "الاقترانات", description: "الاقترانات بأنواعها وخصائصها وتطبيقاتها", category: "math" },
                    { id: 2, name: "التفاضل", description: "قواعد التفاضل وتطبيقاتها في المشتقات", category: "math" },
                    { id: 3, name: "التكامل", description: "طرق التكامل المختلفة وتطبيقاتها في المساحات", category: "math" },
                    { id: 4, name: "المصفوفات", description: "عمليات المصفوفات وتطبيقاتها في الأعمال", category: "business" },
                    { id: 5, name: "البرمجة الخطية", description: "نماذج البرمجة الخطية وتطبيقاتها في تحسين القرارات", category: "business" }
                ];
                saveToLocalStorage('units', units);
            }
            
            if (savedStudents) {
                students = JSON.parse(savedStudents);
                document.getElementById('students-count').textContent = students.length;
            } else {
                // بيانات طلاب افتراضية
                students = [
                    { id: 1, name: "أحمد محمد", studentId: "S001", class: "class1", email: "ahmed@example.com", status: "active" },
                    { id: 2, name: "سارة عبدالله", studentId: "S002", class: "class1", email: "sara@example.com", status: "active" },
                    { id: 3, name: "خالد إبراهيم", studentId: "S003", class: "class2", email: "khaled@example.com", status: "active" },
                    { id: 4, name: "فاطمة علي", studentId: "S004", class: "class2", email: "fatima@example.com", status: "active" },
                    { id: 5, name: "محمد حسن", studentId: "S005", class: "class3", email: "mohamed@example.com", status: "active" }
                ];
                saveToLocalStorage('students', students);
                document.getElementById('students-count').textContent = students.length;
            }
            
            if (savedResults) {
                testResults = JSON.parse(savedResults);
            } else {
                // بيانات نتائج افتراضية
                testResults = [
                    { id: 1, studentId: "S001", studentName: "أحمد محمد", class: "شعبة 1", test: "اختبار الاقترانات", date: "2023-10-15", score: "85/100", percentage: "85%" },
                    { id: 2, studentId: "S002", studentName: "سارة عبدالله", class: "شعبة 1", test: "اختبار الاقترانات", date: "2023-10-15", score: "92/100", percentage: "92%" },
                    { id: 3, studentId: "S003", studentName: "خالد إبراهيم", class: "شعبة 2", test: "اختبار التفاضل", date: "2023-10-10", score: "78/100", percentage: "78%" },
                    { id: 4, studentId: "S004", studentName: "فاطمة علي", class: "شعبة 2", test: "اختبار التكامل", date: "2023-10-05", score: "88/100", percentage: "88%" }
                ];
                saveToLocalStorage('testResults', testResults);
            }
            
            if (savedDarkMode) {
                darkMode = savedDarkMode === 'true';
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    document.querySelector('.dark-mode-toggle i').classList.remove('fa-moon');
                    document.querySelector('.dark-mode-toggle i').classList.add('fa-sun');
                }
            }
        }
        
        // حفظ البيانات إلى localStorage
        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }
        
        // تهيئة الرسوم البيانية
        function initCharts() {
            // رسم بياني لتوزيع الدرجات
            const scoreCtx = document.getElementById('scoreDistributionChart');
            if (scoreCtx) {
                new Chart(scoreCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['0-20', '21-40', '41-60', '61-80', '81-100'],
                        datasets: [{
                            label: 'عدد الطلاب',
                            data: [2, 5, 12, 25, 43],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'توزيع درجات الطلاب'
                            }
                        }
                    }
                });
            }
            
            // رسم بياني لصعوبة الأسئلة
            const difficultyCtx = document.getElementById('questionDifficultyChart');
            if (difficultyCtx) {
                new Chart(difficultyCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['أسئلة سهلة', 'أسئلة متوسطة', 'أسئلة صعبة'],
                        datasets: [{
                            data: [65, 25, 10],
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.5)',
                                'rgba(255, 206, 86, 0.5)',
                                'rgba(255, 99, 132, 0.5)'
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'صعوبة الأسئلة في الاختبارات'
                            }
                        }
                    }
                });
            }
            
            // رسم بياني لمستويات الأسئلة
            const levelCtx = document.getElementById('questionLevelChart');
            if (levelCtx) {
                new Chart(levelCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['سهل', 'متوسط', 'صعب'],
                        datasets: [{
                            data: [85, 120, 38],
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.5)',
                                'rgba(54, 162, 235, 0.5)',
                                'rgba(255, 99, 132, 0.5)'
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'توزيع الأسئلة حسب مستوى الصعوبة'
                            }
                        }
                    }
                });
            }
            
            // رسم بياني للوحدات
            const unitCtx = document.getElementById('questionUnitChart');
            if (unitCtx) {
                new Chart(unitCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['الاقترانات', 'التفاضل', 'التكامل', 'المصفوفات', 'البرمجة الخطية'],
                        datasets: [{
                            label: 'عدد الأسئلة',
                            data: [54, 38, 42, 27, 33],
                            backgroundColor: 'rgba(153, 102, 255, 0.5)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'عدد الأسئلة في كل وحدة'
                            }
                        }
                    }
                });
            }
            
            // رسم بياني لتصنيف بلوم
            const bloomCtx = document.getElementById('bloomDistributionChart');
            if (bloomCtx) {
                new Chart(bloomCtx.getContext('2d'), {
                    type: 'polarArea',
                    data: {
                        labels: ['التذكر', 'الفهم', 'التطبيق', 'التحليل', 'التركيب', 'التقويم'],
                        datasets: [{
                            data: [60, 75, 45, 30, 25, 15],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.5)',
                                'rgba(54, 162, 235, 0.5)',
                                'rgba(255, 206, 86, 0.5)',
                                'rgba(75, 192, 192, 0.5)',
                                'rgba(153, 102, 255, 0.5)',
                                'rgba(255, 159, 64, 0.5)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'توزيع الأسئلة حسب تصنيف بلوم'
                            }
                        }
                    }
                });
            }
        }
        
        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // التحويل بين التبويبات
            const tabLinks = document.querySelectorAll('.nav-link');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // إزالة النشاط من جميع الروابط
                    tabLinks.forEach(l => l.classList.remove('active'));
                    
                    // إضافة النشاط للرابط الحالي
                    this.classList.add('active');
                    
                    // إخفاء جميع المحتويات
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // إظهار المحتوى المطلوب
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // إرسال نموذج إنشاء البنك
            document.getElementById('bankForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const bankName = document.getElementById('bank-name').value;
                const bankDescription = document.getElementById('bank-description').value;
                const bankCategory = document.getElementById('bank-category').value;
                const bankUnit = document.getElementById('bank-unit').value;
                const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
                const targetAudience = document.getElementById('target-audience').value;
                
                if (!bankName || !bankCategory || !bankUnit) {
                    alert('يرجى ملء جميع الحقول الإلزامية');
                    return;
                }
                
                // إنشاء بنك جديد
                const newBank = {
                    id: Date.now(),
                    name: bankName,
                    description: bankDescription,
                    category: bankCategory,
                    unit: bankUnit,
                    difficulty: difficulty,
                    targetAudience: targetAudience,
                    createdBy: document.getElementById('user-name').textContent,
                    createdAt: new Date().toLocaleDateString('ar-SA'),
                    questions: []
                };
                
                questionBanks.push(newBank);
                saveToLocalStorage('questionBanks', questionBanks);
                
                // إظهار رسالة النجاح
                document.getElementById('bankForm').style.display = 'none';
                document.getElementById('bank-success').style.display = 'block';
                
                // تحديث العدد في الصفحة الرئيسية
                document.getElementById('banks-count').textContent = questionBanks.length;
            });
            
            // إرسال نموذج إنشاء الاختبار
            document.getElementById('testForm').addEventListener('submit', function(e) {
                e.preventDefault();
                generateTest();
            });
            
            // إغلاق قائمة الإجراءات السريعة عند النقر خارجها
            document.addEventListener('click', function(e) {
                const quickActionsMenu = document.getElementById('quick-actions-menu');
                const quickActionBtn = document.querySelector('.quick-action-btn');
                
                if (!quickActionsMenu.contains(e.target) && !quickActionBtn.contains(e.target)) {
                    quickActionsMenu.classList.remove('show');
                }
            });
        }
        
        // عرض بنوك الأسئلة في قسم إدارة البنوك
        function displayQuestionBanks() {
            const banksContainer = document.getElementById('banks-container');
            banksContainer.innerHTML = '';
            
            if (questionBanks.length === 0) {
                banksContainer.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد بنوك أسئلة</h4>
                        <p>يمكنك إنشاء بنك أسئلة جديد من قسم "إنشاء بنك أسئلة"</p>
                    </div>
                `;
                return;
            }
            
            questionBanks.forEach(bank => {
                const bankCard = document.createElement('div');
                bankCard.className = 'form-card';
                bankCard.innerHTML = `
                    <div class="bank-header d-flex justify-content-between align-items-center">
                        <h4>${bank.name}</h4>
                        <div>
                            <span class="badge ${bank.category === 'math' ? 'bg-primary' : 'bg-success'}">${bank.category === 'math' ? 'رياضيات متقدم' : 'رياضيات أعمال'}</span>
                            <span class="badge bg-secondary">${getUnitName(bank.unit)}</span>
                        </div>
                    </div>
                    <p class="text-muted">${bank.description || 'لا يوجد وصف'}</p>
                    <div class="bank-details">
                        <div class="row">
                            <div class="col-md-4">
                                <strong>مستوى الصعوبة:</strong> 
                                <span class="badge ${bank.difficulty === 'easy' ? 'bg-success' : bank.difficulty === 'medium' ? 'bg-warning' : 'bg-danger'}">
                                    ${bank.difficulty === 'easy' ? 'سهل' : bank.difficulty === 'medium' ? 'متوسط' : 'صعب'}
                                </span>
                            </div>
                            <div class="col-md-4">
                                <strong>عدد الأسئلة:</strong> ${bank.questions.length}
                            </div>
                            <div class="col-md-4">
                                <strong>تاريخ الإنشاء:</strong> ${bank.createdAt}
                            </div>
                        </div>
                    </div>
                    <div class="action-btn">
                        <button class="btn btn-sm btn-primary" onclick="viewBank(${bank.id})">
                            <i class="fas fa-eye me-1"></i>عرض الأسئلة
                        </button>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addQuestionModal" data-bank-id="${bank.id}">
                            <i class="fas fa-plus me-1"></i>إضافة سؤال
                        </button>
                        <button class="btn btn-sm btn-info" onclick="selectQuestionsFromBank(${bank.id})">
                            <i class="fas fa-check-square me-1"></i>اختيار أسئلة
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteBank(${bank.id})">
                            <i class="fas fa-trash me-1"></i>حذف البنك
                        </button>
                    </div>
                `;
                banksContainer.appendChild(bankCard);
            });
        }
        
        // عرض الطلاب في قسم إدارة الطلاب
        function displayStudents() {
            const studentsList = document.getElementById('students-list');
            studentsList.innerHTML = '';
            
            if (students.length === 0) {
                studentsList.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد طلاب مسجلين</h4>
                        <p>يمكنك إضافة طلاب جديدين باستخدام زر "إضافة طالب جديد"</p>
                    </div>
                `;
                return;
            }
            
            students.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <div>
                        <h6>${student.name}</h6>
                        <p class="text-muted mb-0">${student.studentId} | ${getClassName(student.class)}</p>
                    </div>
                    <div>
                        <span class="badge ${student.status === 'active' ? 'bg-success' : 'bg-secondary'}">${student.status === 'active' ? 'نشط' : 'غير نشط'}</span>
                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="editStudent(${student.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent(${student.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                studentsList.appendChild(studentItem);
            });
        }
        
        // عرض نتائج الاختبارات
        function displayTestResults() {
            const resultsBody = document.getElementById('results-table-body');
            resultsBody.innerHTML = '';
            
            if (testResults.length === 0) {
                resultsBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">لا توجد نتائج اختبارات</td>
                    </tr>
                `;
                return;
            }
            
            testResults.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.studentName}</td>
                    <td>${result.class}</td>
                    <td>${result.test}</td>
                    <td>${result.date}</td>
                    <td>${result.score}</td>
                    <td>${result.percentage}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="viewTestResult(${result.id})">تفاصيل</button>
                    </td>
                `;
                resultsBody.appendChild(row);
            });
        }
        
        // عرض الوحدات في قسم إدارة الوحدات
        function displayUnits() {
            const unitsContainer = document.getElementById('units-container');
            unitsContainer.innerHTML = '';
            
            if (units.length === 0) {
                unitsContainer.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info text-center">
                            <i class="fas fa-info-circle fa-2x mb-3"></i>
                            <h4>لا توجد وحدات مسجلة</h4>
                            <p>يمكنك إضافة وحدات جديدة باستخدام زر "إضافة وحدة جديدة"</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            units.forEach(unit => {
                const unitCard = document.createElement('div');
                unitCard.className = 'col-md-4 mb-4';
                unitCard.innerHTML = `
                    <div class="unit-card">
                        <div class="unit-header">
                            <h5>${unit.name}</h5>
                            <span class="badge ${unit.category === 'math' ? 'bg-primary' : 'bg-success'}">${unit.category === 'math' ? 'رياضيات' : 'أعمال'}</span>
                        </div>
                        <p class="text-muted">${unit.description || 'لا يوجد وصف'}</p>
                        <div class="action-btn">
                            <button class="btn btn-sm btn-primary" onclick="editUnit(${unit.id})">تعديل</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUnit(${unit.id})">حذف</button>
                        </div>
                    </div>
                `;
                unitsContainer.appendChild(unitCard);
            });
        }
        
        // الحصول على اسم الوحدة من القيمة
        function getUnitName(unitValue) {
            switch(unitValue) {
                case 'functions': return 'الاقترانات';
                case 'trigonometry': return 'المعادلات المثلثية';
                case 'differentiation': return 'التفاضل';
                case 'complex': return 'الأعداد المركبة';
                case 'integration': return 'التكامل';
                case 'vectors': return 'المتجهات';
                case 'statistics': return 'الإحصاء';
                case 'matrices': return 'المصفوفات';
                case 'decision': return 'اتخاذ القرار';
                case 'linear': return 'البرمجة الخطية';
                default: return unitValue;
            }
        }
        
        // الحصول على اسم الشعبة من القيمة
        function getClassName(classValue) {
            switch(classValue) {
                case 'class1': return 'شعبة 1';
                case 'class2': return 'شعبة 2';
                case 'class3': return 'شعبة 3';
                default: return classValue;
            }
        }
        
        // عرض بنك أسئلة محدد
        function viewBank(bankId) {
            const bank = questionBanks.find(b => b.id === bankId);
            if (!bank) return;
            
            const banksContainer = document.getElementById('banks-container');
            banksContainer.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4>أسئلة بنك: ${bank.name}</h4>
                    <button class="btn btn-sm btn-secondary" onclick="displayQuestionBanks()">
                        <i class="fas fa-arrow-right me-1"></i>العودة إلى البنوك
                    </button>
                </div>
            `;
            
            if (bank.questions.length === 0) {
                banksContainer.innerHTML += `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد أسئلة في هذا البنك</h4>
                        <p>يمكنك إضافة أسئلة جديدة باستخدام زر "إضافة سؤال"</p>
                    </div>
                `;
                return;
            }
            
            bank.questions.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                let questionTypeBadge = '';
                if (question.type === 'multiple') {
                    questionTypeBadge = '<span class="question-type-badge multiple-choice-badge">اختيار من متعدد</span>';
                } else if (question.type === 'truefalse') {
                    questionTypeBadge = '<span class="question-type-badge true-false-badge">صح أم خطأ</span>';
                } else if (question.type === 'shortanswer') {
                    questionTypeBadge = '<span class="question-type-badge short-answer-badge">إجابة قصيرة</span>';
                } else if (question.type === 'essay') {
                    questionTypeBadge = '<span class="question-type-badge essay-badge">مقالي</span>';
                }
                
                questionCard.innerHTML = `
                    <div class="question-header">
                        <h5>السؤال ${index + 1}</h5>
                        <div>
                            ${questionTypeBadge}
                            <span class="question-tag level ${question.difficulty === 'easy' ? 'bg-success' : question.difficulty === 'medium' ? 'bg-warning' : 'bg-danger'}">
                                ${question.difficulty === 'easy' ? 'سهل' : question.difficulty === 'medium' ? 'متوسط' : 'صعب'}
                            </span>
                        </div>
                    </div>
                    <p>${question.text}</p>
                    ${question.type === 'multiple' ? `
                        <div class="options-container">
                            ${question.options.map((option, i) => `
                                <div class="option-item ${option.correct ? 'correct-answer' : ''}">
                                    <span>${i + 1}. ${option.text}</span>
                                    ${option.correct ? '<span class="badge bg-success">إجابة صحيحة</span>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    ` : question.type === 'truefalse' ? `
                        <div class="options-container">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="q${question.id}" id="q${question.id}true" ${question.correctAnswer === 'true' ? 'checked' : ''}>
                                <label class="form-check-label" for="q${question.id}true">صح</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="q${question.id}" id="q${question.id}false" ${question.correctAnswer === 'false' ? 'checked' : ''}>
                                <label class="form-check-label" for="q${question.id}false">خطأ</label>
                            </div>
                        </div>
                    ` : question.type === 'shortanswer' ? `
                        <div class="form-group mt-3">
                            <label>الإجابة النموذجية:</label>
                            <p class="bg-light p-2 rounded">${question.modelAnswer || 'لا توجد إجابة نموذجية'}</p>
                        </div>
                    ` : question.type === 'essay' ? `
                        <div class="form-group mt-3">
                            <label>نموذج الإجابة:</label>
                            <p class="bg-light p-2 rounded">${question.modelAnswer || 'لا يوجد نموذج إجابة'}</p>
                            <label class="mt-2">معايير التقييم:</label>
                            <p class="bg-light p-2 rounded">${question.evaluationCriteria || 'لا توجد معايير تقييم'}</p>
                        </div>
                    ` : ''}
                    <div class="question-footer d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-info">${getBloomLevelName(question.bloom)}</span>
                            <span class="badge bg-primary">${question.points} نقاط</span>
                        </div>
                        <div class="question-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="editQuestion(${bank.id}, ${question.id})">تعديل</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteQuestion(${bank.id}, ${question.id})">حذف</button>
                        </div>
                    </div>
                `;
                banksContainer.appendChild(questionCard);
            });
        }
        
        // الحصول على اسم مستوى بلوم من القيمة
        function getBloomLevelName(bloomValue) {
            switch(bloomValue) {
                case 'knowledge': return 'التذكر';
                case 'comprehension': return 'الفهم';
                case 'application': return 'التطبيق';
                case 'analysis': return 'التحليل';
                case 'synthesis': return 'التركيب';
                case 'evaluation': return 'التقويم';
                default: return bloomValue;
            }
        }
        
        // تبديل خيارات السؤال حسب النوع
        function toggleQuestionOptions() {
            const questionType = document.getElementById('question-type').value;
            const optionsContainer = document.getElementById('options-container');
            const shortAnswerContainer = document.getElementById('short-answer-container');
            const essayContainer = document.getElementById('essay-container');
            const correctAnswerSection = document.getElementById('correct-answer-section');
            
            // إخفاء جميع الحاويات أولاً
            optionsContainer.style.display = 'none';
            shortAnswerContainer.style.display = 'none';
            essayContainer.style.display = 'none';
            correctAnswerSection.style.display = 'none';
            
            // إظهار الحاوية المناسبة حسب نوع السؤال
            if (questionType === 'multiple') {
                optionsContainer.style.display = 'block';
                correctAnswerSection.style.display = 'block';
                updateCorrectAnswerOptions();
            } else if (questionType === 'truefalse') {
                optionsContainer.style.display = 'block';
                correctAnswerSection.style.display = 'block';
                // إخفاء زر إضافة خيار لأسئلة صح/خطأ
                document.querySelector('.add-option-btn').style.display = 'none';
                // التأكد من وجود خيارين فقط
                const optionItems = document.querySelectorAll('.option-item');
                if (optionItems.length > 2) {
                    for (let i = 2; i < optionItems.length; i++) {
                        optionItems[i].remove();
                    }
                }
                updateCorrectAnswerOptions();
            } else if (questionType === 'shortanswer') {
                shortAnswerContainer.style.display = 'block';
            } else if (questionType === 'essay') {
                essayContainer.style.display = 'block';
            }
        }
        
        // تحديث خيارات الإجابة الصحيحة
        function updateCorrectAnswerOptions() {
            const correctAnswerOptions = document.getElementById('correct-answer-options');
            const optionItems = document.querySelectorAll('.option-item');
            const questionType = document.getElementById('question-type').value;
            
            correctAnswerOptions.innerHTML = '';
            
            if (questionType === 'multiple' || questionType === 'truefalse') {
                optionItems.forEach((item, index) => {
                    const textInput = item.querySelector('input[type="text"]');
                    const radioInput = item.querySelector('input[type="radio"]');
                    
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'correct-answer-option';
                    optionDiv.innerHTML = `
                        <input type="radio" name="correct-answer-radio" id="correct-option-${index}" value="${index}" ${radioInput.checked ? 'checked' : ''}>
                        <label for="correct-option-${index}">${textInput.value || `الخيار ${index + 1}`}</label>
                    `;
                    
                    // إضافة مستمع حدث لتحديث حالة الخيار الأصلي عند التغيير
                    const correctRadio = optionDiv.querySelector('input[type="radio"]');
                    correctRadio.addEventListener('change', function() {
                        // إلغاء تحديد جميع الخيارات الأصلية
                        optionItems.forEach(opt => {
                            opt.querySelector('input[type="radio"]').checked = false;
                        });
                        
                        // تحديد الخيار الأصلي المطابق
                        if (this.checked) {
                            optionItems[index].querySelector('input[type="radio"]').checked = true;
                        }
                    });
                    
                    correctAnswerOptions.appendChild(optionDiv);
                });
            }
        }
        
        // إضافة خيار جديد في نموذج السؤال
        function addOption() {
            const optionsContainer = document.getElementById('options-container');
            const optionItem = document.createElement('div');
            optionItem.className = 'option-item';
            optionItem.innerHTML = `
                <span class="remove-option" onclick="removeOption(this)">×</span>
                <input type="radio" name="correct-answer">
                <input type="text" class="form-control" placeholder="نص الخيار" required>
            `;
            optionsContainer.insertBefore(optionItem, optionsContainer.lastElementChild);
            
            // تحديث خيارات الإجابة الصحيحة
            updateCorrectAnswerOptions();
        }
        
        // إزالة خيار من نموذج السؤال
        function removeOption(element) {
            const optionItem = element.parentElement;
            const questionType = document.getElementById('question-type').value;
            
            if (questionType === 'truefalse') {
                // لا يمكن حذف خيارات من أسئلة صح/خطأ
                return;
            }
            
            if (document.querySelectorAll('.option-item').length > 2) {
                optionItem.remove();
                // تحديث خيارات الإجابة الصحيحة
                updateCorrectAnswerOptions();
            } else {
                alert('يجب أن يحتوي السؤال على خيارين على الأقل');
            }
        }
        
        // حفظ السؤال الجديد
        function saveQuestion() {
            const questionText = document.getElementById('question-text').value;
            const questionBank = document.getElementById('question-bank').value;
            const questionDifficulty = document.getElementById('question-difficulty').value;
            const questionBloom = document.getElementById('question-bloom').value;
            const questionPoints = document.getElementById('question-points').value;
            const questionType = document.getElementById('question-type').value;
            
            if (!questionText || !questionBank) {
                alert('يرجى ملء جميع الحقول الإلزامية');
                return;
            }
            
            // إنشاء كائن السؤال
            const newQuestion = {
                id: Date.now(),
                text: questionText,
                bankId: parseInt(questionBank),
                difficulty: questionDifficulty,
                bloom: questionBloom,
                points: parseInt(questionPoints),
                type: questionType,
                createdAt: new Date().toLocaleDateString('ar-SA')
            };
            
            // جمع خيارات الإجابة للأسئلة الاختيارية
            if (questionType === 'multiple') {
                const optionItems = document.querySelectorAll('.option-item');
                let hasCorrect = false;
                let options = [];
                
                optionItems.forEach(item => {
                    const textInput = item.querySelector('input[type="text"]');
                    const radioInput = item.querySelector('input[type="radio"]');
                    
                    if (textInput.value) {
                        options.push({
                            text: textInput.value,
                            correct: radioInput.checked
                        });
                        
                        if (radioInput.checked) hasCorrect = true;
                    }
                });
                
                if (!hasCorrect) {
                    alert('يرجى تحديد الإجابة الصحيحة');
                    return;
                }
                
                if (options.length < 2) {
                    alert('يرجى إضافة خيارين على الأقل');
                    return;
                }
                
                newQuestion.options = options;
            } else if (questionType === 'truefalse') {
                const optionItems = document.querySelectorAll('.option-item');
                const radioInputs = document.querySelectorAll('input[name="correct-answer"]');
                
                for (let i = 0; i < radioInputs.length; i++) {
                    if (radioInputs[i].checked) {
                        newQuestion.correctAnswer = i === 0 ? 'true' : 'false';
                        break;
                    }
                }
            } else if (questionType === 'shortanswer') {
                newQuestion.modelAnswer = document.getElementById('short-answer').value;
            } else if (questionType === 'essay') {
                newQuestion.modelAnswer = document.getElementById('essay-answer').value;
                newQuestion.evaluationCriteria = document.getElementById('essay-criteria').value;
            }
            
            // إضافة السؤال إلى بنك الأسئلة
            const bankIndex = questionBanks.findIndex(b => b.id === newQuestion.bankId);
            if (bankIndex !== -1) {
                questionBanks[bankIndex].questions.push(newQuestion);
                saveToLocalStorage('questionBanks', questionBanks);
                
                // تحديث عدد الأسئلة في الصفحة الرئيسية
                const totalQuestions = questionBanks.reduce((total, bank) => total + bank.questions.length, 0);
                document.getElementById('questions-count').textContent = totalQuestions;
                
                // إغلاق المودال وإعادة تعيين النموذج
                bootstrap.Modal.getInstance(document.getElementById('addQuestionModal')).hide();
                document.getElementById('questionForm').reset();
                
                // إظهار رسالة النجاح
                showNotification('تم حفظ السؤال بنجاح', 'success');
            } else {
                alert('حدث خطأ في إضافة السؤال');
            }
        }
        
        // حفظ الطالب الجديد
        function saveStudent() {
            const studentName = document.getElementById('student-name').value;
            const studentId = document.getElementById('student-id').value;
            const studentClass = document.getElementById('student-class').value;
            const studentEmail = document.getElementById('student-email').value;
            
            if (!studentName || !studentId || !studentClass) {
                alert('يرجى ملء جميع الحقول الإلزامية');
                return;
            }
            
            const newStudent = {
                id: Date.now(),
                name: studentName,
                studentId: studentId,
                class: studentClass,
                email: studentEmail,
                status: 'active'
            };
            
            students.push(newStudent);
            saveToLocalStorage('students', students);
            
            // إغلاق المودال وإعادة تعيين النموذج
            bootstrap.Modal.getInstance(document.getElementById('addStudentModal')).hide();
            document.getElementById('studentForm').reset();
            
            // تحديث عرض الطلاب
            displayStudents();
            document.getElementById('students-count').textContent = students.length;
            
            // إظهار رسالة النجاح
            showNotification('تم حفظ الطالب بنجاح', 'success');
        }
        
        // حفظ الوحدة الجديدة
        function saveUnit() {
            const unitName = document.getElementById('unit-name').value;
            const unitDescription = document.getElementById('unit-description').value;
            const unitCategory = document.getElementById('unit-category').value;
            
            if (!unitName) {
                alert('يرجى إدخال اسم الوحدة');
                return;
            }
            
            const newUnit = {
                id: Date.now(),
                name: unitName,
                description: unitDescription,
                category: unitCategory
            };
            
            units.push(newUnit);
            saveToLocalStorage('units', units);
            
            // إغلاق المودال وإعادة تعيين النموذج
            bootstrap.Modal.getInstance(document.getElementById('addUnitModal')).hide();
            document.getElementById('unitForm').reset();
            
            // تحديث عرض الوحدات
            displayUnits();
            
            // إظهار رسالة النجاح
            showNotification('تم حفظ الوحدة بنجاح', 'success');
        }
        
        // إنشاء اختبار
        function generateTest() {
            const testTitle = document.getElementById('test-title').value;
            const testDuration = document.getElementById('test-duration').value;
            const testDescription = document.getElementById('test-description').value;
            const testCategory = document.getElementById('test-category').value;
            const testUnit = document.getElementById('test-unit').value;
            const questionsCount = document.getElementById('test-questions-count').value;
            
            if (!testTitle || !testDuration || !testCategory || !testUnit || !questionsCount) {
                alert('يرجى ملء جميع الحقول الإلزامية');
                return;
            }
            
            // عرض معاينة الاختبار
            document.getElementById('test-preview').style.display = 'block';
            
            // إنشاء أسئلة وهمية للمعاينة
            const testQuestionsContainer = document.getElementById('test-questions-container');
            testQuestionsContainer.innerHTML = `
                <h5 class="text-center">${testTitle}</h5>
                <p class="text-center">${testDescription}</p>
                <p class="text-center"><strong>المدة: </strong>${testDuration} دقيقة</p>
                <hr>
                
                <div class="question-card">
                    <h5>السؤال 1:</h5>
                    <p>ما هو مشتق الدالة f(x) = x²؟</p>
                    <div class="options-container">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q1" id="q1a1">
                            <label class="form-check-label" for="q1a1">2x</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q1" id="q1a2">
                            <label class="form-check-label" for="q1a2">x²</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q1" id="q1a3">
                            <label class="form-check-label" for="q1a3">2</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q1" id="q1a4">
                            <label class="form-check-label" for="q1a4">x</label>
                        </div>
                    </div>
                </div>
                
                <div class="question-card">
                    <h5>السؤال 2:</h5>
                    <p>ما هي قيمة النهاية التالية: lim(x→0) (sin(x)/x)؟</p>
                    <div class="options-container">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q2" id="q2a1">
                            <label class="form-check-label" for="q2a1">0</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q2" id="q2a2">
                            <label class="form-check-label" for="q2a2">1</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q2" id="q2a3">
                            <label class="form-check-label" for="q2a3">∞</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q2" id="q2a4">
                            <label class="form-check-label" for="q2a4">غير موجودة</label>
                        </div>
                    </div>
                </div>
            `;
            
            // إضافة الاختبار إلى القائمة
            const newTest = {
                id: Date.now(),
                title: testTitle,
                duration: testDuration,
                description: testDescription,
                category: testCategory,
                unit: testUnit,
                questionsCount: questionsCount,
                createdAt: new Date().toLocaleDateString('ar-SA')
            };
            
            tests.push(newTest);
            saveToLocalStorage('tests', tests);
        }
        
        // تصدير الاختبار للطلاب
        function exportTestToStudents() {
            // افتح نافذة جديدة لعرض الاختبار للطلاب
            const testWindow = window.open('', '_blank');
            testWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>اختبار الطلاب</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
                    <style>
                        body {
                            font-family: 'Tajawal', sans-serif;
                            padding: 20px;
                            background-color: #f8f9fa;
                        }
                        .test-header {
                            background-color: #2c3e50;
                            color: white;
                            padding: 15px;
                            border-radius: 10px;
                            margin-bottom: 20px;
                        }
                        .question-card {
                            background-color: white;
                            border-radius: 8px;
                            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
                            padding: 20px;
                            margin-bottom: 20px;
                        }
                        .timer {
                            position: fixed;
                            top: 20px;
                            left: 20px;
                            background-color: #e74c3c;
                            color: white;
                            padding: 10px 15px;
                            border-radius: 5px;
                            font-weight: bold;
                            z-index: 1000;
                        }
                        .result-summary {
                            background-color: #f8f9fa;
                            border-radius: 10px;
                            padding: 20px;
                            margin-top: 20px;
                            border-left: 4px solid #2ecc71;
                        }
                        .question-result {
                            margin-bottom: 15px;
                            padding: 15px;
                            border-radius: 8px;
                            background-color: white;
                            border: 1px solid #eee;
                        }
                        .question-result.correct {
                            border-left: 4px solid #2ecc71;
                        }
                        .question-result.incorrect {
                            border-left: 4px solid #e74c3c;
                        }
                        .question-result-header {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 10px;
                        }
                        .question-result-status {
                            font-weight: 600;
                        }
                        .question-result-status.correct {
                            color: #2ecc71;
                        }
                        .question-result-status.incorrect {
                            color: #e74c3c;
                        }
                    </style>
                </head>
                <body>
                    <div class="timer" id="timer">الوقت المتبقي: 60:00</div>
                    
                    <div class="container" id="test-container">
                        <div class="test-header text-center">
                            <h2>${document.getElementById('test-title').value}</h2>
                            <p>${document.getElementById('test-description').value}</p>
                            <p><strong>المدة: </strong>${document.getElementById('test-duration').value} دقيقة</p>
                        </div>
                        
                        <div class="student-info mb-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>اسم الطالب:</label>
                                        <input type="text" class="form-control" id="student-name-input">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>الشعبة:</label>
                                        <select class="form-select" id="student-class-select">
                                            <option value="">اختر الشعبة</option>
                                            <option value="class1">شعبة 1</option>
                                            <option value="class2">شعبة 2</option>
                                            <option value="class3">شعبة 3</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${document.getElementById('test-questions-container').innerHTML}
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-primary btn-lg" onclick="submitTest()">تسليم الاختبار</button>
                        </div>
                    </div>
                    
                    <script>
                        // مؤقت الاختبار
                        let timeLeft = ${document.getElementById('test-duration').value} * 60; // بالثواني
                        const timerElement = document.getElementById('timer');
                        
                        const timerInterval = setInterval(() => {
                            timeLeft--;
                            const minutes = Math.floor(timeLeft / 60);
                            const seconds = timeLeft % 60;
                            timerElement.textContent = \`الوقت المتبقي: \${minutes}:\${seconds < 10 ? '0' : ''}\${seconds}\`;
                            
                            if (timeLeft <= 0) {
                                clearInterval(timerInterval);
                                submitTest();
                            }
                        }, 1000);
                        
                        function submitTest() {
                            const studentName = document.getElementById('student-name-input').value;
                            const studentClass = document.getElementById('student-class-select').value;
                            
                            if (!studentName || !studentClass) {
                                alert('يرجى إدخال اسم الطالب والشعبة');
                                return;
                            }
                            
                            clearInterval(timerInterval);
                            
                            // جمع الإجابات
                            const answers = [];
                            const questions = document.querySelectorAll('.question-card');
                            
                            questions.forEach((question, index) => {
                                const selectedOption = question.querySelector('input[type="radio"]:checked');
                                if (selectedOption) {
                                    answers.push({
                                        question: index + 1,
                                        answer: selectedOption.id,
                                        correct: selectedOption.id === 'q1a1' || selectedOption.id === 'q2a2' // الإجابات الصحيحة
                                    });
                                } else {
                                    answers.push({
                                        question: index + 1,
                                        answer: null,
                                        correct: false
                                    });
                                }
                            });
                            
                            // حساب النتيجة
                            const correctAnswers = answers.filter(a => a.correct).length;
                            const totalQuestions = answers.length;
                            const score = Math.round((correctAnswers / totalQuestions) * 100);
                            
                            // إظهار النتائج
                            const testContainer = document.getElementById('test-container');
                            testContainer.innerHTML = \`
                                <div class="result-summary">
                                    <h2 class="text-center">نتيجة الاختبار</h2>
                                    <div class="text-center mb-4">
                                        <h3>\${studentName}</h3>
                                        <p>\${studentClass}</p>
                                    </div>
                                    <div class="text-center mb-4">
                                        <h1>\${score}%</h1>
                                        <p>الدرجة الكلية</p>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 text-center">
                                            <h4>\${correctAnswers}</h4>
                                            <p>إجابات صحيحة</p>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h4>\${totalQuestions - correctAnswers}</h4>
                                            <p>إجابات خاطئة</p>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h4>\${totalQuestions}</h4>
                                            <p>الأسئلة الكلية</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <h3 class="mt-5">تفاصيل الإجابات</h3>
                            \`;
                            
                            // عرض تفاصيل الإجابات
                            answers.forEach(answer => {
                                const resultDiv = document.createElement('div');
                                resultDiv.className = \`question-result \${answer.correct ? 'correct' : 'incorrect'}\`;
                                resultDiv.innerHTML = \`
                                    <div class="question-result-header">
                                        <h5>السؤال \${answer.question}</h5>
                                        <span class="question-result-status \${answer.correct ? 'correct' : 'incorrect'}">
                                            \${answer.correct ? 'صحيحة' : 'خاطئة'}
                                        </span>
                                    </div>
                                    <p>إجابتك: \${answer.answer ? document.getElementById(answer.answer).nextElementSibling.textContent : 'لم تتم الإجابة'}</p>
                                    \${!answer.correct ? '<p>الإجابة الصحيحة: ' + (answer.question === 1 ? '2x' : '1') + '</p>' : ''}
                                \`;
                                testContainer.appendChild(resultDiv);
                            });
                            
                            alert('تم تسليم الاختبار بنجاح');
                        }
                    <\/script>
                </body>
                </html>
            `);
            testWindow.document.close();
        }
        
        // تحميل الاختبار
        function downloadTest() {
            alert('سيتم تحميل الاختبار في شكل PDF');
            // هنا يمكنك إضافة منطق لتحويل الاختبار إلى PDF وتنزيله
        }
        
        // طباعة الاختبار
        function printTest() {
            window.print();
        }
        
        // طباعة نتائج الطلاب
        function printResults() {
            alert('سيتم طباعة نتائج الطلاب');
            // هنا يمكنك إضافة منطق لطباعة النتائج
        }
        
        // تصدير نتائج الطلاب
        function exportResults() {
            alert('سيتم تصدير نتائج الطلاب إلى ملف Excel');
            // هنا يمكنك إضافة منطق لتصدير النتائج
        }
        
        // استيراد قائمة الطلاب
        function importStudents() {
            alert('سيتم فتح نافذة لاستيراد قائمة الطلاب من ملف Excel');
            // هنا يمكنك إضافة منطق لاستيراد الطلاب
        }
        
        // إعادة تعيين عوامل التصفية للطلاب
        function resetStudentFilters() {
            document.getElementById('filter-class').value = '';
            document.getElementById('filter-status').value = '';
            displayStudents();
        }
        
        // حذف بنك أسئلة
        function deleteBank(bankId) {
            if (confirm('هل أنت متأكد من حذف هذا البنك؟ سيتم حذف جميع الأسئلة المرتبطة به.')) {
                questionBanks = questionBanks.filter(b => b.id !== bankId);
                saveToLocalStorage('questionBanks', questionBanks);
                displayQuestionBanks();
                
                // تحديث العدد في الصفحة الرئيسية
                document.getElementById('banks-count').textContent = questionBanks.length;
                const totalQuestions = questionBanks.reduce((total, bank) => total + bank.questions.length, 0);
                document.getElementById('questions-count').textContent = totalQuestions;
                
                showNotification('تم حذف البنك بنجاح', 'success');
            }
        }
        
        // حذف وحدة
        function deleteUnit(unitId) {
            if (confirm('هل أنت متأكد من حذف هذه الوحدة؟')) {
                units = units.filter(u => u.id !== unitId);
                saveToLocalStorage('units', units);
                displayUnits();
                
                showNotification('تم حذف الوحدة بنجاح', 'success');
            }
        }
        
        // تعديل وحدة
        function editUnit(unitId) {
            const unit = units.find(u => u.id === unitId);
            if (!unit) return;
            
            // ملء النموذج ببيانات الوحدة
            document.getElementById('unit-name').value = unit.name;
            document.getElementById('unit-description').value = unit.description || '';
            document.getElementById('unit-category').value = unit.category;
            
            // فتح المودال
            const modal = new bootstrap.Modal(document.getElementById('addUnitModal'));
            modal.show();
            
            // تغيير عنوان المودال
            document.getElementById('addUnitModalLabel').textContent = 'تعديل بيانات الوحدة';
            
            // تغيير زر الحفظ
            const saveButton = document.querySelector('#addUnitModal .btn-primary');
            saveButton.textContent = 'حفظ التعديلات';
            saveButton.onclick = function() {
                updateUnit(unitId);
            };
        }
        
        // تحديث بيانات الوحدة
        function updateUnit(unitId) {
            const unitIndex = units.findIndex(u => u.id === unitId);
            if (unitIndex === -1) return;
            
            const unitName = document.getElementById('unit-name').value;
            const unitDescription = document.getElementById('unit-description').value;
            const unitCategory = document.getElementById('unit-category').value;
            
            if (!unitName) {
                alert('يرجى إدخال اسم الوحدة');
                return;
            }
            
            units[unitIndex] = {
                ...units[unitIndex],
                name: unitName,
                description: unitDescription,
                category: unitCategory
            };
            
            saveToLocalStorage('units', units);
            
            // إغلاق المودال
            bootstrap.Modal.getInstance(document.getElementById('addUnitModal')).hide();
            
            // إعادة تعيين النموذج
            document.getElementById('unitForm').reset();
            
            // تحديث عرض الوحدات
            displayUnits();
            
            showNotification('تم تحديث بيانات الوحدة بنجاح', 'success');
        }
        
        // حذف طالب
        function deleteStudent(studentId) {
            if (confirm('هل أنت متأكد من حذف هذا الطالب؟')) {
                students = students.filter(s => s.id !== studentId);
                saveToLocalStorage('students', students);
                displayStudents();
                document.getElementById('students-count').textContent = students.length;
                
                showNotification('تم حذف الطالب بنجاح', 'success');
            }
        }
        
        // تعديل طالب
        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            // ملء النموذج ببيانات الطالب
            document.getElementById('student-name').value = student.name;
            document.getElementById('student-id').value = student.studentId;
            document.getElementById('student-class').value = student.class;
            document.getElementById('student-email').value = student.email || '';
            
            // فتح المودال
            const modal = new bootstrap.Modal(document.getElementById('addStudentModal'));
            modal.show();
            
            // تغيير عنوان المودال
            document.getElementById('addStudentModalLabel').textContent = 'تعديل بيانات الطالب';
            
            // تغيير زر الحفظ
            const saveButton = document.querySelector('#addStudentModal .btn-primary');
            saveButton.textContent = 'حفظ التعديلات';
            saveButton.onclick = function() {
                updateStudent(studentId);
            };
        }
        
        // تحديث بيانات الطالب
        function updateStudent(studentId) {
            const studentIndex = students.findIndex(s => s.id === studentId);
            if (studentIndex === -1) return;
            
            const studentName = document.getElementById('student-name').value;
            const studentIdValue = document.getElementById('student-id').value;
            const studentClass = document.getElementById('student-class').value;
            const studentEmail = document.getElementById('student-email').value;
            
            if (!studentName || !studentIdValue || !studentClass) {
                alert('يرجى ملء جميع الحقول الإلزامية');
                return;
            }
            
            students[studentIndex] = {
                ...students[studentIndex],
                name: studentName,
                studentId: studentIdValue,
                class: studentClass,
                email: studentEmail
            };
            
            saveToLocalStorage('students', students);
            
            // إغلاق المودال
            bootstrap.Modal.getInstance(document.getElementById('addStudentModal')).hide();
            
            // إعادة تعيين النموذج
            document.getElementById('studentForm').reset();
            
            // تحديث عرض الطلاب
            displayStudents();
            
            showNotification('تم تحديث بيانات الطالب بنجاح', 'success');
        }
        
        // تعديل سؤال
        function editQuestion(bankId, questionId) {
            const bank = questionBanks.find(b => b.id === bankId);
            if (!bank) return;
            
            const question = bank.questions.find(q => q.id === questionId);
            if (!question) return;
            
            // ملء النموذج ببيانات السؤال
            document.getElementById('question-text').value = question.text;
            document.getElementById('question-bank').value = question.bankId;
            document.getElementById('question-difficulty').value = question.difficulty;
            document.getElementById('question-bloom').value = question.bloom;
            document.getElementById('question-points').value = question.points;
            document.getElementById('question-type').value = question.type;
            
            // تحديث خيارات السؤال حسب النوع
            toggleQuestionOptions();
            
            if (question.type === 'multiple' && question.options) {
                // مسح الخيارات الموجودة
                const optionItems = document.querySelectorAll('.option-item');
                optionItems.forEach(item => item.remove());
                
                // إضافة الخيارات من السؤال
                const optionsContainer = document.getElementById('options-container');
                const addButton = optionsContainer.querySelector('.add-option-btn');
                
                question.options.forEach((option, index) => {
                    const optionItem = document.createElement('div');
                    optionItem.className = 'option-item';
                    optionItem.innerHTML = `
                        <span class="remove-option" onclick="removeOption(this)">×</span>
                        <input type="radio" name="correct-answer" ${option.correct ? 'checked' : ''}>
                        <input type="text" class="form-control" placeholder="نص الخيار" value="${option.text}" required>
                    `;
                    optionsContainer.insertBefore(optionItem, addButton);
                });
                
                // تحديث خيارات الإجابة الصحيحة
                updateCorrectAnswerOptions();
            } else if (question.type === 'truefalse') {
                // تحديد الإجابة الصحيحة
                const radioInputs = document.querySelectorAll('input[name="correct-answer"]');
                if (question.correctAnswer === 'true' && radioInputs.length > 0) {
                    radioInputs[0].checked = true;
                } else if (question.correctAnswer === 'false' && radioInputs.length > 1) {
                    radioInputs[1].checked = true;
                }
                
                // تحديث خيارات الإجابة الصحيحة
                updateCorrectAnswerOptions();
            } else if (question.type === 'shortanswer') {
                document.getElementById('short-answer').value = question.modelAnswer || '';
            } else if (question.type === 'essay') {
                document.getElementById('essay-answer').value = question.modelAnswer || '';
                document.getElementById('essay-criteria').value = question.evaluationCriteria || '';
            }
            
            // فتح المودال
            const modal = new bootstrap.Modal(document.getElementById('addQuestionModal'));
            modal.show();
            
            // تغيير عنوان المودال
            document.getElementById('addQuestionModalLabel').textContent = 'تعديل السؤال';
            
            // تغيير زر الحفظ
            const saveButton = document.querySelector('#addQuestionModal .btn-primary');
            saveButton.textContent = 'حفظ التعديلات';
            saveButton.onclick = function() {
                updateQuestion(bankId, questionId);
            };
        }
        
        // تحديث بيانات السؤال
        function updateQuestion(bankId, questionId) {
            const bankIndex = questionBanks.findIndex(b => b.id === bankId);
            if (bankIndex === -1) return;
            
            const questionIndex = questionBanks[bankIndex].questions.findIndex(q => q.id === questionId);
            if (questionIndex === -1) return;
            
            const questionText = document.getElementById('question-text').value;
            const questionDifficulty = document.getElementById('question-difficulty').value;
            const questionBloom = document.getElementById('question-bloom').value;
            const questionPoints = document.getElementById('question-points').value;
            const questionType = document.getElementById('question-type').value;
            
            if (!questionText) {
                alert('يرجى إدخال نص السؤال');
                return;
            }
            
            // تحديث بيانات السؤال
            questionBanks[bankIndex].questions[questionIndex] = {
                ...questionBanks[bankIndex].questions[questionIndex],
                text: questionText,
                difficulty: questionDifficulty,
                bloom: questionBloom,
                points: parseInt(questionPoints),
                type: questionType
            };
            
            // تحديث خيارات الإجابة للأسئلة الاختيارية
            if (questionType === 'multiple') {
                const optionItems = document.querySelectorAll('.option-item');
                let hasCorrect = false;
                let options = [];
                
                optionItems.forEach(item => {
                    const textInput = item.querySelector('input[type="text"]');
                    const radioInput = item.querySelector('input[type="radio"]');
                    
                    if (textInput.value) {
                        options.push({
                            text: textInput.value,
                            correct: radioInput.checked
                        });
                        
                        if (radioInput.checked) hasCorrect = true;
                    }
                });
                
                if (!hasCorrect) {
                    alert('يرجى تحديد الإجابة الصحيحة');
                    return;
                }
                
                if (options.length < 2) {
                    alert('يرجى إضافة خيارين على الأقل');
                    return;
                }
                
                questionBanks[bankIndex].questions[questionIndex].options = options;
            } else if (questionType === 'truefalse') {
                const radioInputs = document.querySelectorAll('input[name="correct-answer"]');
                
                for (let i = 0; i < radioInputs.length; i++) {
                    if (radioInputs[i].checked) {
                        questionBanks[bankIndex].questions[questionIndex].correctAnswer = i === 0 ? 'true' : 'false';
                        break;
                    }
                }
            } else if (questionType === 'shortanswer') {
                questionBanks[bankIndex].questions[questionIndex].modelAnswer = document.getElementById('short-answer').value;
            } else if (questionType === 'essay') {
                questionBanks[bankIndex].questions[questionIndex].modelAnswer = document.getElementById('essay-answer').value;
                questionBanks[bankIndex].questions[questionIndex].evaluationCriteria = document.getElementById('essay-criteria').value;
            }
            
            saveToLocalStorage('questionBanks', questionBanks);
            
            // إغلاق المودال
            bootstrap.Modal.getInstance(document.getElementById('addQuestionModal')).hide();
            
            // إعادة تعيين النموذج
            document.getElementById('questionForm').reset();
            
            // تحديث عرض الأسئلة
            viewBank(bankId);
            
            showNotification('تم تحديث السؤال بنجاح', 'success');
        }
        
        // حذف سؤال
        function deleteQuestion(bankId, questionId) {
            if (confirm('هل أنت متأكد من حذف هذا السؤال؟')) {
                const bankIndex = questionBanks.findIndex(b => b.id === bankId);
                if (bankIndex === -1) return;
                
                questionBanks[bankIndex].questions = questionBanks[bankIndex].questions.filter(q => q.id !== questionId);
                saveToLocalStorage('questionBanks', questionBanks);
                
                // تحديث العدد في الصفحة الرئيسية
                const totalQuestions = questionBanks.reduce((total, bank) => total + bank.questions.length, 0);
                document.getElementById('questions-count').textContent = totalQuestions;
                
                // تحديث عرض الأسئلة
                viewBank(bankId);
                
                showNotification('تم حذف السؤال بنجاح', 'success');
            }
        }
        
        // إعادة تعيين نموذج البنك
        function resetBankForm() {
            document.getElementById('bank-name').value = '';
            document.getElementById('bank-description').value = '';
            document.getElementById('bank-category').value = '';
            document.getElementById('bank-unit').value = '';
            document.getElementById('target-audience').value = '';
            document.querySelector('input[name="difficulty"][value="medium"]').checked = true;
        }
        
        // إعادة تعيين نموذج الاختبار
        function resetTestForm() {
            document.getElementById('test-title').value = '';
            document.getElementById('test-duration').value = '60';
            document.getElementById('test-description').value = '';
            document.getElementById('test-category').value = '';
            document.getElementById('test-unit').value = '';
            document.getElementById('test-questions-count').value = '10';
            document.getElementById('easy-percent').value = '20';
            document.getElementById('medium-percent').value = '60';
            document.getElementById('hard-percent').value = '20';
            document.getElementById('test-preview').style.display = 'none';
        }
        
        // الانتقال إلى إدارة البنوك
        function goToManageBanks() {
            document.querySelector('[data-tab="manage-banks"]').click();
            displayQuestionBanks();
        }
        
        // إنشاء بنك آخر
        function createAnotherBank() {
            document.getElementById('bankForm').style.display = 'block';
            document.getElementById('bank-success').style.display = 'none';
            resetBankForm();
        }
        
        // وظيفة تسجيل الخروج
        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                showNotification('تم تسجيل الخروج بنجاح', 'success');
                // هنا يمكنك إضافة منطق لتسجيل الخروج مثل إعادة التوجيه إلى صفحة تسجيل الدخول
            }
        }
        
        // تبديل الوضع الليلي
        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode');
            
            const icon = document.querySelector('.dark-mode-toggle i');
            if (darkMode) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
            
            localStorage.setItem('darkMode', darkMode);
        }
        
        // تبديل قائمة الإجراءات السريعة
        function toggleQuickActions() {
            const quickActionsMenu = document.getElementById('quick-actions-menu');
            quickActionsMenu.classList.toggle('show');
        }
        
        // إضافة سؤال سريع
        function quickAddQuestion() {
            // إغلاق قائمة الإجراءات السريعة
            document.getElementById('quick-actions-menu').classList.remove('show');
            
            // الانتقال إلى قسم إدارة البنوك
            document.querySelector('[data-tab="manage-banks"]').click();
            
            // فتح نافذة إضافة سؤال بعد تأخير بسيط
            setTimeout(() => {
                const modal = new bootstrap.Modal(document.getElementById('addQuestionModal'));
                modal.show();
            }, 300);
        }
        
        // إنشاء اختبار سريع
        function quickCreateTest() {
            // إغلاق قائمة الإجراءات السريعة
            document.getElementById('quick-actions-menu').classList.remove('show');
            
            // الانتقال إلى قسم إنشاء اختبار
            document.querySelector('[data-tab="create-test"]').click();
        }
        
        // إضافة طالب سريع
        function quickAddStudent() {
            // إغلاق قائمة الإجراءات السريعة
            document.getElementById('quick-actions-menu').classList.remove('show');
            
            // الانتقال إلى قسم إدارة الطلاب
            document.querySelector('[data-tab="manage-students"]').click();
            
            // فتح نافذة إضافة طالب بعد تأخير بسيط
            setTimeout(() => {
                const modal = new bootstrap.Modal(document.getElementById('addStudentModal'));
                modal.show();
            }, 300);
        }
        
        // تصدير البيانات
        function exportData() {
            // إغلاق قائمة الإجراءات السريعة
            document.getElementById('quick-actions-menu').classList.remove('show');
            
            // إنشاء كائن يحتوي على جميع البيانات
            const allData = {
                questionBanks: questionBanks,
                units: units,
                students: students,
                tests: tests,
                testResults: testResults,
                exportDate: new Date().toLocaleDateString('ar-SA')
            };
            
            // تحويل الكائن إلى JSON
            const dataStr = JSON.stringify(allData, null, 2);
            
            // إنشاء ملف للتنزيل
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            // إنشاء رابط للتنزيل
            const exportFileDefaultName = `بنك_الأسئلة_${new Date().toLocaleDateString('ar-SA').replace(/\//g, '-')}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('تم تصدير البيانات بنجاح', 'success');
        }
        
        // البحث في بنوك الأسئلة
        function searchBanks() {
            const searchTerm = document.getElementById('bank-search').value.toLowerCase();
            
            if (!searchTerm) {
                displayQuestionBanks();
                return;
            }
            
            const banksContainer = document.getElementById('banks-container');
            banksContainer.innerHTML = '';
            
            const filteredBanks = questionBanks.filter(bank => 
                bank.name.toLowerCase().includes(searchTerm) || 
                (bank.description && bank.description.toLowerCase().includes(searchTerm))
            );
            
            if (filteredBanks.length === 0) {
                banksContainer.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد نتائج للبحث</h4>
                        <p>لم يتم العثور على بنوك أسئلة تطابق مصطلح البحث</p>
                    </div>
                `;
                return;
            }
            
            filteredBanks.forEach(bank => {
                const bankCard = document.createElement('div');
                bankCard.className = 'form-card';
                
                // تمييز مصطلح البحث في النتائج
                const highlightedName = bank.name.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`);
                const highlightedDescription = bank.description ? bank.description.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`) : 'لا يوجد وصف';
                
                bankCard.innerHTML = `
                    <div class="bank-header d-flex justify-content-between align-items-center">
                        <h4>${highlightedName}</h4>
                        <div>
                            <span class="badge ${bank.category === 'math' ? 'bg-primary' : 'bg-success'}">${bank.category === 'math' ? 'رياضيات متقدم' : 'رياضيات أعمال'}</span>
                            <span class="badge bg-secondary">${getUnitName(bank.unit)}</span>
                        </div>
                    </div>
                    <p class="text-muted">${highlightedDescription}</p>
                    <div class="bank-details">
                        <div class="row">
                            <div class="col-md-4">
                                <strong>مستوى الصعوبة:</strong> 
                                <span class="badge ${bank.difficulty === 'easy' ? 'bg-success' : bank.difficulty === 'medium' ? 'bg-warning' : 'bg-danger'}">
                                    ${bank.difficulty === 'easy' ? 'سهل' : bank.difficulty === 'medium' ? 'متوسط' : 'صعب'}
                                </span>
                            </div>
                            <div class="col-md-4">
                                <strong>عدد الأسئلة:</strong> ${bank.questions.length}
                            </div>
                            <div class="col-md-4">
                                <strong>تاريخ الإنشاء:</strong> ${bank.createdAt}
                            </div>
                        </div>
                    </div>
                    <div class="action-btn">
                        <button class="btn btn-sm btn-primary" onclick="viewBank(${bank.id})">
                            <i class="fas fa-eye me-1"></i>عرض الأسئلة
                        </button>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addQuestionModal" data-bank-id="${bank.id}">
                            <i class="fas fa-plus me-1"></i>إضافة سؤال
                        </button>
                        <button class="btn btn-sm btn-info" onclick="selectQuestionsFromBank(${bank.id})">
                            <i class="fas fa-check-square me-1"></i>اختيار أسئلة
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteBank(${bank.id})">
                            <i class="fas fa-trash me-1"></i>حذف البنك
                        </button>
                    </div>
                `;
                banksContainer.appendChild(bankCard);
            });
        }
        
        // البحث في الطلاب
        function searchStudents() {
            const searchTerm = document.getElementById('student-search').value.toLowerCase();
            
            if (!searchTerm) {
                displayStudents();
                return;
            }
            
            const studentsList = document.getElementById('students-list');
            studentsList.innerHTML = '';
            
            const filteredStudents = students.filter(student => 
                student.name.toLowerCase().includes(searchTerm) || 
                student.studentId.toLowerCase().includes(searchTerm)
            );
            
            if (filteredStudents.length === 0) {
                studentsList.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد نتائج للبحث</h4>
                        <p>لم يتم العثور على طلاب تطابق مصطلح البحث</p>
                    </div>
                `;
                return;
            }
            
            filteredStudents.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                
                // تمييز مصطلح البحث في النتائج
                const highlightedName = student.name.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`);
                const highlightedId = student.studentId.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`);
                
                studentItem.innerHTML = `
                    <div>
                        <h6>${highlightedName}</h6>
                        <p class="text-muted mb-0">${highlightedId} | ${getClassName(student.class)}</p>
                    </div>
                    <div>
                        <span class="badge ${student.status === 'active' ? 'bg-success' : 'bg-secondary'}">${student.status === 'active' ? 'نشط' : 'غير نشط'}</span>
                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="editStudent(${student.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent(${student.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                studentsList.appendChild(studentItem);
            });
        }
        
        // البحث في الوحدات
        function searchUnits() {
            const searchTerm = document.getElementById('unit-search').value.toLowerCase();
            
            if (!searchTerm) {
                displayUnits();
                return;
            }
            
            const unitsContainer = document.getElementById('units-container');
            unitsContainer.innerHTML = '';
            
            const filteredUnits = units.filter(unit => 
                unit.name.toLowerCase().includes(searchTerm) || 
                (unit.description && unit.description.toLowerCase().includes(searchTerm))
            );
            
            if (filteredUnits.length === 0) {
                unitsContainer.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info text-center">
                            <i class="fas fa-info-circle fa-2x mb-3"></i>
                            <h4>لا توجد نتائج للبحث</h4>
                            <p>لم يتم العثور على وحدات تطابق مصطلح البحث</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            filteredUnits.forEach(unit => {
                const unitCard = document.createElement('div');
                unitCard.className = 'col-md-4 mb-4';
                
                // تمييز مصطلح البحث في النتائج
                const highlightedName = unit.name.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`);
                const highlightedDescription = unit.description ? unit.description.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`) : 'لا يوجد وصف';
                
                unitCard.innerHTML = `
                    <div class="unit-card">
                        <div class="unit-header">
                            <h5>${highlightedName}</h5>
                            <span class="badge ${unit.category === 'math' ? 'bg-primary' : 'bg-success'}">${unit.category === 'math' ? 'رياضيات' : 'أعمال'}</span>
                        </div>
                        <p class="text-muted">${highlightedDescription}</p>
                        <div class="action-btn">
                            <button class="btn btn-sm btn-primary" onclick="editUnit(${unit.id})">تعديل</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUnit(${unit.id})">حذف</button>
                        </div>
                    </div>
                `;
                unitsContainer.appendChild(unitCard);
            });
        }
        
        // تصفية بنوك الأسئلة
        function filterBanks() {
            const categoryFilter = document.getElementById('filter-category').value;
            const unitFilter = document.getElementById('filter-unit').value;
            const difficultyFilter = document.getElementById('filter-difficulty').value;
            
            // تحديث علامات التصفية
            updateFilterTags();
            
            const banksContainer = document.getElementById('banks-container');
            banksContainer.innerHTML = '';
            
            let filteredBanks = questionBanks;
            
            if (categoryFilter) {
                filteredBanks = filteredBanks.filter(bank => bank.category === categoryFilter);
            }
            
            if (unitFilter) {
                filteredBanks = filteredBanks.filter(bank => bank.unit === unitFilter);
            }
            
            if (difficultyFilter) {
                filteredBanks = filteredBanks.filter(bank => bank.difficulty === difficultyFilter);
            }
            
            if (filteredBanks.length === 0) {
                banksContainer.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد بنوك تطابق معايير التصفية</h4>
                        <p>حاول تغيير معايير التصفية أو إعادة تعيينها</p>
                    </div>
                `;
                return;
            }
            
            filteredBanks.forEach(bank => {
                const bankCard = document.createElement('div');
                bankCard.className = 'form-card';
                bankCard.innerHTML = `
                    <div class="bank-header d-flex justify-content-between align-items-center">
                        <h4>${bank.name}</h4>
                        <div>
                            <span class="badge ${bank.category === 'math' ? 'bg-primary' : 'bg-success'}">${bank.category === 'math' ? 'رياضيات متقدم' : 'رياضيات أعمال'}</span>
                            <span class="badge bg-secondary">${getUnitName(bank.unit)}</span>
                        </div>
                    </div>
                    <p class="text-muted">${bank.description || 'لا يوجد وصف'}</p>
                    <div class="bank-details">
                        <div class="row">
                            <div class="col-md-4">
                                <strong>مستوى الصعوبة:</strong> 
                                <span class="badge ${bank.difficulty === 'easy' ? 'bg-success' : bank.difficulty === 'medium' ? 'bg-warning' : 'bg-danger'}">
                                    ${bank.difficulty === 'easy' ? 'سهل' : bank.difficulty === 'medium' ? 'متوسط' : 'صعب'}
                                </span>
                            </div>
                            <div class="col-md-4">
                                <strong>عدد الأسئلة:</strong> ${bank.questions.length}
                            </div>
                            <div class="col-md-4">
                                <strong>تاريخ الإنشاء:</strong> ${bank.createdAt}
                            </div>
                        </div>
                    </div>
                    <div class="action-btn">
                        <button class="btn btn-sm btn-primary" onclick="viewBank(${bank.id})">
                            <i class="fas fa-eye me-1"></i>عرض الأسئلة
                        </button>
                        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addQuestionModal" data-bank-id="${bank.id}">
                            <i class="fas fa-plus me-1"></i>إضافة سؤال
                        </button>
                        <button class="btn btn-sm btn-info" onclick="selectQuestionsFromBank(${bank.id})">
                            <i class="fas fa-check-square me-1"></i>اختيار أسئلة
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteBank(${bank.id})">
                            <i class="fas fa-trash me-1"></i>حذف البنك
                        </button>
                    </div>
                `;
                banksContainer.appendChild(bankCard);
            });
        }
        
        // تصفية الطلاب
        function filterStudents() {
            const classFilter = document.getElementById('filter-class').value;
            const statusFilter = document.getElementById('filter-status').value;
            
            const studentsList = document.getElementById('students-list');
            studentsList.innerHTML = '';
            
            let filteredStudents = students;
            
            if (classFilter) {
                filteredStudents = filteredStudents.filter(student => student.class === classFilter);
            }
            
            if (statusFilter) {
                filteredStudents = filteredStudents.filter(student => student.status === statusFilter);
            }
            
            if (filteredStudents.length === 0) {
                studentsList.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد طلاب تطابق معايير التصفية</h4>
                        <p>حاول تغيير معايير التصفية أو إعادة تعيينها</p>
                    </div>
                `;
                return;
            }
            
            filteredStudents.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <div>
                        <h6>${student.name}</h6>
                        <p class="text-muted mb-0">${student.studentId} | ${getClassName(student.class)}</p>
                    </div>
                    <div>
                        <span class="badge ${student.status === 'active' ? 'bg-success' : 'bg-secondary'}">${student.status === 'active' ? 'نشط' : 'غير نشط'}</span>
                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="editStudent(${student.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent(${student.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                studentsList.appendChild(studentItem);
            });
        }
        
        // تحديث علامات التصفية
        function updateFilterTags() {
            const filterTagsContainer = document.getElementById('filter-tags');
            filterTagsContainer.innerHTML = '';
            
            const categoryFilter = document.getElementById('filter-category').value;
            const unitFilter = document.getElementById('filter-unit').value;
            const difficultyFilter = document.getElementById('filter-difficulty').value;
            
            if (categoryFilter) {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                tag.innerHTML = `
                    القسم: ${categoryFilter === 'math' ? 'رياضيات متقدم' : 'رياضيات أعمال'}
                    <span class="remove-tag" onclick="removeFilter('filter-category')">×</span>
                `;
                filterTagsContainer.appendChild(tag);
            }
            
            if (unitFilter) {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                tag.innerHTML = `
                    الوحدة: ${getUnitName(unitFilter)}
                    <span class="remove-tag" onclick="removeFilter('filter-unit')">×</span>
                `;
                filterTagsContainer.appendChild(tag);
            }
            
            if (difficultyFilter) {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                tag.innerHTML = `
                    الصعوبة: ${difficultyFilter === 'easy' ? 'سهل' : difficultyFilter === 'medium' ? 'متوسط' : 'صعب'}
                    <span class="remove-tag" onclick="removeFilter('filter-difficulty')">×</span>
                `;
                filterTagsContainer.appendChild(tag);
            }
        }
        
        // إزالة عامل تصفية
        function removeFilter(filterId) {
            document.getElementById(filterId).value = '';
            filterBanks();
        }
        
        // إظهار إشعار
        function showNotification(message, type = 'info') {
            // إنشاء عنصر الإشعار
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.top = '20px';
            notification.style.left = '20px';
            notification.style.zIndex = '9999';
            notification.style.minWidth = '300px';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // إضافة الإشعار إلى الصفحة
            document.body.appendChild(notification);
            
            // إغلاق الإشعار تلقائياً بعد 3 ثواني
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // إظهار شاشة التحميل
        function showLoading() {
            document.getElementById('loading-spinner').classList.add('show');
        }
        
        // إخفاء شاشة التحميل
        function hideLoading() {
            document.getElementById('loading-spinner').classList.remove('show');
        }
        
        // اختيار الأسئلة من البنك
        function selectQuestionsFromBank(bankId) {
            const bank = questionBanks.find(b => b.id === bankId);
            if (!bank) return;
            
            // تعيين بنك الأسئلة المحدد
            document.getElementById('question-bank').value = bankId;
            
            // فتح نافذة اختيار الأسئلة
            const modal = new bootstrap.Modal(document.getElementById('selectQuestionsModal'));
            modal.show();
            
            // عرض الأسئلة في النافذة
            displayQuestionsForSelection(bankId);
        }
        
        // عرض الأسئلة للاختيار
        function displayQuestionsForSelection(bankId) {
            const bank = questionBanks.find(b => b.id === bankId);
            if (!bank) return;
            
            const questionSelector = document.getElementById('question-selector');
            questionSelector.innerHTML = '';
            
            if (bank.questions.length === 0) {
                questionSelector.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد أسئلة في هذا البنك</h4>
                        <p>يمكنك إضافة أسئلة جديدة باستخدام زر "إضافة سؤال"</p>
                    </div>
                `;
                return;
            }
            
            bank.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'form-check';
                
                let questionTypeBadge = '';
                if (question.type === 'multiple') {
                    questionTypeBadge = '<span class="question-type-badge multiple-choice-badge">اختيار من متعدد</span>';
                } else if (question.type === 'truefalse') {
                    questionTypeBadge = '<span class="question-type-badge true-false-badge">صح أم خطأ</span>';
                } else if (question.type === 'shortanswer') {
                    questionTypeBadge = '<span class="question-type-badge short-answer-badge">إجابة قصيرة</span>';
                } else if (question.type === 'essay') {
                    questionTypeBadge = '<span class="question-type-badge essay-badge">مقالي</span>';
                }
                
                questionDiv.innerHTML = `
                    <input class="form-check-input" type="checkbox" value="${question.id}" id="question-${question.id}" onchange="updateSelectedQuestionsCount()">
                    <label class="form-check-label" for="question-${question.id}">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>السؤال ${index + 1}:</strong> ${question.text.substring(0, 50)}${question.text.length > 50 ? '...' : ''}
                            </div>
                            <div class="question-meta">
                                ${questionTypeBadge}
                                <span class="badge ${question.difficulty === 'easy' ? 'bg-success' : question.difficulty === 'medium' ? 'bg-warning' : 'bg-danger'}">
                                    ${question.difficulty === 'easy' ? 'سهل' : question.difficulty === 'medium' ? 'متوسط' : 'صعب'}
                                </span>
                                <span class="badge bg-primary">${question.points} نقاط</span>
                            </div>
                        </div>
                    </label>
                `;
                questionSelector.appendChild(questionDiv);
            });
        }
        
        // تحديث عدد الأسئلة المحددة
        function updateSelectedQuestionsCount() {
            const selectedCheckboxes = document.querySelectorAll('#question-selector input[type="checkbox"]:checked');
            const countElement = document.querySelector('.selected-questions-count');
            countElement.textContent = `الأسئلة المحددة: ${selectedCheckboxes.length}`;
        }
        
        // مسح تحديد الأسئلة
        function clearSelectedQuestions() {
            const checkboxes = document.querySelectorAll('#question-selector input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedQuestionsCount();
        }
        
        // إضافة الأسئلة المحددة
        function addSelectedQuestions() {
            const selectedCheckboxes = document.querySelectorAll('#question-selector input[type="checkbox"]:checked');
            
            if (selectedCheckboxes.length === 0) {
                alert('يرجى تحديد سؤال واحد على الأقل');
                return;
            }
            
            // جمع معرفات الأسئلة المحددة
            const selectedQuestionIds = Array.from(selectedCheckboxes).map(checkbox => parseInt(checkbox.value));
            
            // هنا يمكنك إضافة منطق لإضافة الأسئلة المحددة إلى الاختبار الحالي
            // أو أي منطق آخر حسب احتياجاتك
            
            // إغلاق المودال
            bootstrap.Modal.getInstance(document.getElementById('selectQuestionsModal')).hide();
            
            // إظهار رسالة النجاح
            showNotification(`تم إضافة ${selectedQuestionIds.length} أسئلة بنجاح`, 'success');
        }
        
        // عرض نتيجة اختبار محددة
        function viewTestResult(resultId) {
            const result = testResults.find(r => r.id === resultId);
            if (!result) return;
            
            // إنشاء نافذة منبثقة لعرض تفاصيل النتيجة
            const resultWindow = window.open('', '_blank');
            resultWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>تفاصيل نتيجة الاختبار</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
                    <style>
                        body {
                            font-family: 'Tajawal', sans-serif;
                            padding: 20px;
                            background-color: #f8f9fa;
                        }
                        .result-header {
                            background-color: #2c3e50;
                            color: white;
                            padding: 15px;
                            border-radius: 10px;
                            margin-bottom: 20px;
                        }
                        .result-summary {
                            background-color: #f8f9fa;
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                            border-left: 4px solid #2ecc71;
                        }
                        .question-result {
                            margin-bottom: 15px;
                            padding: 15px;
                            border-radius: 8px;
                            background-color: white;
                            border: 1px solid #eee;
                        }
                        .question-result.correct {
                            border-left: 4px solid #2ecc71;
                        }
                        .question-result.incorrect {
                            border-left: 4px solid #e74c3c;
                        }
                        .question-result-header {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 10px;
                        }
                        .question-result-status {
                            font-weight: 600;
                        }
                        .question-result-status.correct {
                            color: #2ecc71;
                        }
                        .question-result-status.incorrect {
                            color: #e74c3c;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="result-header text-center">
                            <h2>تفاصيل نتيجة الاختبار</h2>
                        </div>
                        
                        <div class="result-summary">
                            <div class="row">
                                <div class="col-md-6">
                                    <h4>معلومات الطالب</h4>
                                    <p><strong>الاسم:</strong> ${result.studentName}</p>
                                    <p><strong>الرقم:</strong> ${result.studentId}</p>
                                    <p><strong>الشعبة:</strong> ${result.class}</p>
                                </div>
                                <div class="col-md-6">
                                    <h4>معلومات الاختبار</h4>
                                    <p><strong>الاختبار:</strong> ${result.test}</p>
                                    <p><strong>التاريخ:</strong> ${result.date}</p>
                                    <p><strong>الدرجة:</strong> ${result.score} (${result.percentage})</p>
                                </div>
                            </div>
                        </div>
                        
                        <h3>تفاصيل الإجابات</h3>
                        <div class="question-result correct">
                            <div class="question-result-header">
                                <h5>السؤال 1</h5>
                                <span class="question-result-status correct">صحيحة</span>
                            </div>
                            <p>ما هو مشتق الدالة f(x) = x²؟</p>
                            <p><strong>إجابة الطالب:</strong> 2x</p>
                        </div>
                        
                        <div class="question-result correct">
                            <div class="question-result-header">
                                <h5>السؤال 2</h5>
                                <span class="question-result-status correct">صحيحة</span>
                            </div>
                            <p>ما هي قيمة النهاية التالية: lim(x→0) (sin(x)/x)؟</p>
                            <p><strong>إجابة الطالب:</strong> 1</p>
                        </div>
                        
                        <div class="question-result incorrect">
                            <div class="question-result-header">
                                <h5>السؤال 3</h5>
                                <span class="question-result-status incorrect">خاطئة</span>
                            </div>
                            <p>احسب تكامل الدالة f(x) = 3x² + 2x</p>
                            <p><strong>إجابة الطالب:</strong> x³ + x²</p>
                            <p><strong>الإجابة الصحيحة:</strong> x³ + x² + c</p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            resultWindow.document.close();
        }
        
        // البحث في الأسئلة
        function searchQuestions() {
            const searchTerm = document.getElementById('question-search').value.toLowerCase();
            
            if (!searchTerm) {
                // إعادة عرض جميع الأسئلة
                const bankId = document.getElementById('question-bank').value;
                if (bankId) {
                    displayQuestionsForSelection(parseInt(bankId));
                }
                return;
            }
            
            const questionSelector = document.getElementById('question-selector');
            questionSelector.innerHTML = '';
            
            // الحصول على جميع الأسئلة من جميع البنوك
            let allQuestions = [];
            questionBanks.forEach(bank => {
                bank.questions.forEach(question => {
                    allQuestions.push({
                        ...question,
                        bankName: bank.name
                    });
                });
            });
            
            // تصفية الأسئلة حسب مصطلح البحث
            const filteredQuestions = allQuestions.filter(question => 
                question.text.toLowerCase().includes(searchTerm)
            );
            
            if (filteredQuestions.length === 0) {
                questionSelector.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>لا توجد نتائج للبحث</h4>
                        <p>لم يتم العثور على أسئلة تطابق مصطلح البحث</p>
                    </div>
                `;
                return;
            }
            
            filteredQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'form-check';
                
                let questionTypeBadge = '';
                if (question.type === 'multiple') {
                    questionTypeBadge = '<span class="question-type-badge multiple-choice-badge">اختيار من متعدد</span>';
                } else if (question.type === 'truefalse') {
                    questionTypeBadge = '<span class="question-type-badge true-false-badge">صح أم خطأ</span>';
                } else if (question.type === 'shortanswer') {
                    questionTypeBadge = '<span class="question-type-badge short-answer-badge">إجابة قصيرة</span>';
                } else if (question.type === 'essay') {
                    questionTypeBadge = '<span class="question-type-badge essay-badge">مقالي</span>';
                }
                
                // تمييز مصطلح البحث في النتائج
                const highlightedText = question.text.replace(new RegExp(searchTerm, 'gi'), match => `<span class="search-highlight">${match}</span>`);
                
                questionDiv.innerHTML = `
                    <input class="form-check-input" type="checkbox" value="${question.id}" id="question-${question.id}" onchange="updateSelectedQuestionsCount()">
                    <label class="form-check-label" for="question-${question.id}">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>السؤال ${index + 1}:</strong> ${highlightedText.substring(0, 50)}${highlightedText.length > 50 ? '...' : ''}
                                <br>
                                <small class="text-muted">${question.bankName}</small>
                            </div>
                            <div class="question-meta">
                                ${questionTypeBadge}
                                <span class="badge ${question.difficulty === 'easy' ? 'bg-success' : question.difficulty === 'medium' ? 'bg-warning' : 'bg-danger'}">
                                    ${question.difficulty === 'easy' ? 'سهل' : question.difficulty === 'medium' ? 'متوسط' : 'صعب'}
                                </span>
                                <span class="badge bg-primary">${question.points} نقاط</span>
                            </div>
                        </div>
                    </label>
                `;
                questionSelector.appendChild(questionDiv);
            });
        }
    </script>
</body>
</html>